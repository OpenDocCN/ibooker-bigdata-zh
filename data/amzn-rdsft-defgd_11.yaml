- en: Chapter 10\. Monitoring and Administration
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第10章. 监控与管理
- en: You can’t improve what you don’t measure.
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你无法改进你不测量的东西。
- en: ''
  id: totrans-2
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Peter Drucker
  id: totrans-3
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 彼得·德鲁克
- en: As a fully managed cloud data warehouse, Amazon Redshift continuously monitors
    your database and automatically captures and stores data related to the resource
    utilization and details of workloads you run on your data warehouse. As a user
    of the data warehouse, you can focus on ingesting and analyzing data and need
    not continuously monitor or administer. Amazon Redshift makes the operational
    data available for you to monitor and handle exceptions to ensure optimal performance
    of the data warehouse.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个完全托管的云数据仓库，亚马逊 Redshift 不断监控您的数据库，并自动捕获和存储与资源利用率以及您在数据仓库上运行的工作负载相关的数据。作为数据仓库的用户，您可以专注于数据的摄取和分析，无需持续监控或管理。亚马逊
    Redshift 使操作数据可供您监控，并处理异常以确保数据仓库的最佳性能。
- en: You can view your Amazon Redshift data warehouse operational metrics on the
    Amazon Redshift console, use AWS CloudWatch, and directly query Amazon Redshift
    system tables. In this chapter, we will start with an [“Amazon Redshift Monitoring
    Overview”](#Amazon-Redshift-monitoring-overview) and dive into various options
    to monitor Amazon Redshift provisioned cluster and serverless. We’ll start with
    [“Monitoring Using Console”](#Monitoring-using-console), and discuss [“Monitoring
    and Administering Serverless”](#Monitoring-administering-serverless) and [“Monitoring
    Provisioned Data Warehouse Using Console”](#Monitoring-administering-provisioned).
    Then we will cover both provisioned cluster and serverless [“Monitoring Using
    Amazon CloudWatch”](#Monitoring-using-cloudwatch) and [“Monitoring Using System
    Tables and Views”](#monitoring-using-system-tables). Today, resilience and high
    availability have becoming important for data warehouse workloads. We will cover
    how you can set up [“High Availability and Disaster Recovery”](#High-availability-and-disaster-recovery)
    along with [“Snapshots, Backup, and Restore”](#Snapshots-restore-backup). Since
    the monitoring details are stored within Redshift in tables and views, you can
    create your own custom visualizations to monitor the data warehouse. We’ll cover
    [“Bring Your Own Visualization Tool to Monitor Amazon Redshift”](#Monitoring-visualization-tools)
    to help you understand how you can use your tool of choice to create custom visualizations.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在亚马逊 Redshift 控制台上查看你的数据仓库操作指标，使用 AWS CloudWatch，并直接查询亚马逊 Redshift 系统表。在本章中，我们将从[“亚马逊
    Redshift 监控概述”](#Amazon-Redshift-monitoring-overview)开始，并深入探讨监控亚马逊 Redshift 预配置集群和无服务器的各种选项。我们将从[“使用控制台进行监控”](#Monitoring-using-console)开始，并讨论[“监控和管理无服务器”](#Monitoring-administering-serverless)以及[“使用控制台监控和管理预配置数据仓库”](#Monitoring-administering-provisioned)。然后我们将涵盖预配置集群和无服务器[“使用亚马逊
    CloudWatch 进行监控”](#Monitoring-using-cloudwatch)和[“使用系统表和视图进行监控”](#monitoring-using-system-tables)。如今，对于数据仓库工作负载来说，弹性和高可用性变得越来越重要。我们将介绍如何设置[“高可用性和灾难恢复”](#High-availability-and-disaster-recovery)以及[“快照、备份和恢复”](#Snapshots-restore-backup)。由于监控细节存储在
    Redshift 的表和视图中，您可以创建自定义可视化来监控数据仓库。我们将涵盖[“使用自定义可视化工具监控亚马逊 Redshift”](#Monitoring-visualization-tools)，帮助您了解如何使用您选择的工具创建自定义可视化。
- en: Amazon Redshift Monitoring Overview
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 亚马逊 Redshift 监控概述
- en: Amazon Redshift provides performance metrics and data so that you can track
    the health and performance of your clusters and databases. [Amazon CloudWatch](https://oreil.ly/rkTBj)
    is a monitoring service that captures logs and metrics from various services in
    AWS. Amazon Redshift records performance data every minute and provides performance
    data from CloudWatch metrics and statistics about query and load data that it
    stores in system tables. You can monitor your Amazon Redshift workloads and resources
    using the console, CloudWatch, or the system tables and views. With the Amazon
    Redshift console, you can view both the CloudWatch metrics and the query/load
    performance data. In addition, you can use Amazon CloudWatch to view system utilization
    and performance information by using standard dashboard templates or by creating
    custom templates.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 亚马逊 Redshift 提供性能指标和数据，以便您可以跟踪集群和数据库的健康和性能。[Amazon CloudWatch](https://oreil.ly/rkTBj)
    是一个监控服务，从 AWS 中的各种服务捕获日志和指标。亚马逊 Redshift 每分钟记录性能数据，并从 CloudWatch 指标和系统表中提供有关查询和加载数据的性能数据和统计信息。您可以使用控制台、CloudWatch
    或系统表和视图来监控您的亚马逊 Redshift 工作负载和资源。通过亚马逊 Redshift 控制台，您可以查看 CloudWatch 指标以及查询/加载性能数据。此外，您可以使用
    Amazon CloudWatch 查看系统利用率和性能信息，方法是使用标准仪表板模板或创建自定义模板。
- en: You can use this information to identify and diagnose workloads that take a
    long time to process and create bottlenecks that prevent other workloads from
    executing efficiently. The use cases for monitoring and diagnosing arise from
    user questions, and they can be categorized as monitoring, troubleshooting, and
    optimization activities. We address some of the common questions in the following
    sections.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以利用这些信息来识别和诊断处理时间长的工作负载，并创建阻碍其他工作负载高效执行的瓶颈。监控和诊断的应用场景源自用户的问题，可以归类为监控、故障排除和优化活动。我们将在以下章节中讨论一些常见问题。
- en: Monitoring
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 监控
- en: '*Monitoring* is a proactive activity where you want to actively look for exceptions
    in your data warehouse to ensure you can put processes in place to avoid downtime
    due to an event that causes a failure in the system. These questions include:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '*监控* 是一种主动的活动，你希望积极寻找数据仓库中的异常情况，以确保可以制定流程来避免因系统故障而导致的停机。这些问题包括：'
- en: How is my data warehouse doing in terms of query performance and resource utilization?
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的数据仓库在查询性能和资源利用率方面表现如何？
- en: How is my data warehouse throughput, concurrency, and latency looking?
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的数据仓库吞吐量、并发性和延迟如何？
- en: Are queries being queued in my cluster?
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查询是否在我的集群中排队？
- en: Which queries or loads are running now?
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 目前有哪些查询或加载正在运行？
- en: Which queries or loads are taking longer than usual?
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪些查询或加载花费的时间比平时长？
- en: What are my top queries by duration in the last hour or last 24 hours?
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最近一小时或最近 24 小时内持续时间最长的查询是什么？
- en: Which queries have failed?
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪些查询失败了？
- en: Is the average query latency for my data warehouse increasing or decreasing
    over time?
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的数据仓库平均查询延迟是随时间增加还是减少？
- en: When will I run out of resources and should consider scaling or workload isolation?
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我应该何时考虑扩展或工作负载隔离，以避免资源不足？
- en: Troubleshooting
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 故障排除
- en: 'When an event has occurred and you are engaged in resolving the issue, you
    are in reactive mode, and the Redshift console provides you with options:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 当发生事件并且你正忙于解决问题时，你处于反应模式，Redshift 控制台为你提供以下选项：
- en: A user complained about performance issues at a specific time. How do I identify
    that SQL and diagnose problems?
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有用户在特定时间抱怨性能问题。如何识别那个 SQL 并诊断问题？
- en: Which other queries were running when my query was slow? Were all queries slow?
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的查询运行缓慢时，还有哪些查询在运行？所有查询都运行缓慢吗？
- en: Is my database overloaded with queries from other users? Is my queue depth increasing
    or decreasing?
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的数据库是否被其他用户的查询过载？我的队列深度是增加还是减少？
- en: How do I identify queries that a specific user runs?
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何识别特定用户运行的查询？
- en: The resources of my data warehouse are running very high. How do I find out
    which queries are running?
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的数据仓库资源使用率非常高。如何查找正在运行的查询？
- en: Optimization
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 优化
- en: 'When you design your data models for your warehouse initially, you go with
    certain assumptions about how the data will be used. However, the user query patterns
    could be different from these assumptions. By monitoring, you can identify areas
    where you can optimize your data warehouse for better performance and utilization:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 当你最初为数据仓库设计数据模型时，你会基于某些关于数据使用方式的假设。然而，用户的查询模式可能与这些假设不同。通过监控，你可以识别出可以优化数据仓库以提升性能和利用率的领域：
- en: How can I optimize the SQL that our end users author?
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何优化我们最终用户编写的 SQL？
- en: Is there any optimization required in my schema design?
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 是否需要优化我的模式设计？
- en: Is there any tuning required for my WLM queues?
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的 WLM 队列是否需要调整？
- en: Can I get any benefit if I enable Concurrency Scaling?
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果启用并发缩放，我能得到什么好处？
- en: Can I proactively monitor workloads to prevent runaway queries?
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我可以主动监控工作负载以防止运行失控的查询吗？
- en: Monitoring Using Console
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用控制台进行监控
- en: The Amazon Redshift console features a monitoring dashboard and options for
    you to create and manage Amazon Redshift data warehouses. The console leverages
    data from Amazon CloudWatch and other system tables to provide you with insights
    into the overall resource utilization of the database and the performance metrics.
    The metrics are available for both provisioned and serverless data warehouses,
    and you can view them in the respective dashboard screens. Both the serverless
    and provisioned cluster dashboards have a main dashboard that shows metrics across
    all the namespaces or clusters you have in the account. You can either view the
    metrics across all namespaces or select a particular namespace or cluster to monitor
    a specific data warehouse. Using the console helps you simplify management of
    your data warehouse by having visibility to the health and performance of the
    data warehouse in one location. The console monitoring metrics are organized in
    various parts on the console, which we’ll discuss in the following sections.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Redshift 控制台提供监控仪表板和选项，用于创建和管理 Amazon Redshift 数据仓库。控制台利用来自 Amazon CloudWatch
    和其他系统表的数据，为您提供有关数据库的整体资源利用率和性能指标的见解。这些指标适用于预配置和无服务器数据仓库，并可在相应的仪表板屏幕中查看。无论是无服务器还是预配置的集群仪表板，都有一个显示所有账户中所有命名空间或集群的指标的主仪表板。您可以查看所有命名空间的指标，也可以选择特定的命名空间或集群以监视特定的数据仓库。使用控制台帮助您通过在一个位置查看数据仓库的健康状况和性能来简化数据仓库的管理。控制台监控指标在控制台的各个部分中组织，我们将在接下来的章节中讨论。
- en: Monitoring and Administering Serverless
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 无服务器的监控和管理
- en: This includes a list of namespaces, query metrics, RPU capacity, and any alarms
    in CloudWatch, as shown in [Figure 10-1](#monitoring_serverless_queries). The
    main serverless dashboard shows details of the query and database metrics across
    all namespaces or workgroups in the account. With this view, you can correlate
    the query workloads with the RPU capacity used to understand which part of the
    day your utilization is higher, and if you need to increase the base RPU for serverless.
    You can also get a view of all failed queries for further analysis on the reasons
    for failure.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 这包括命名空间列表、查询指标、RPU 容量和 CloudWatch 中的任何警报，如 [Figure 10-1](#monitoring_serverless_queries)
    所示。主无服务器仪表板显示了账户中所有命名空间或工作组的查询和数据库指标的详细信息。通过这个视图，您可以将查询工作负载与使用的 RPU 容量相关联，了解一天中哪个时间段您的利用率较高，以及是否需要增加无服务器的基础
    RPU。您还可以查看所有失败的查询，进一步分析失败原因。
- en: '![Serverless Query and database monitoring](assets/ardg_1001.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![无服务器查询和数据库监控](assets/ardg_1001.png)'
- en: Figure 10-1\. Serverless query and database monitoring
  id: totrans-39
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 10-1\. 无服务器查询和数据库监控
- en: The detailed list of metrics available in the serverless dashboard is shown
    in [Table 10-1](#monitoring_metrics_serverless_table). For individual serverless
    instance level metrics, see the next section.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在无服务器仪表板中显示的详细指标列表如 [Table 10-1](#monitoring_metrics_serverless_table) 所示。有关单个无服务器实例级别的指标，请参见下一节。
- en: Table 10-1\. Monitoring metrics in the main dashboard of serverless
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: Table 10-1\. 无服务器主面板中的监控指标
- en: '| Metric | Details |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| 指标 | 详细信息 |'
- en: '| --- | --- |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| Query metrics | Running and queued queries |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| 查询指标 | 运行中和排队中的查询 |'
- en: '|  | RPU capacity used |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '|  | 使用的 RPU 容量 |'
- en: '| Completed and failed queries | Queries completed or failed across timeline
    |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| 完成和失败的查询 | 时间轴上完成或失败的查询 |'
- en: '|  | RPU capacity used |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '|  | 使用的 RPU 容量 |'
- en: '| Number of queries | Count of queries across timeline |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| 查询数量 | 时间轴上的查询计数 |'
- en: '|  | RPU capacity used |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '|  | 使用的 RPU 容量 |'
- en: Additional monitoring options to monitor query, database, and resources are
    available, which you can get to by clicking the left menu buttons. Here, under
    Monitoring, you will see the option for “Query and database monitoring” and “Resource
    monitoring.”
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 还有其他监控选项可用于监控查询、数据库和资源，您可以通过单击左侧菜单按钮进入。在这里，您将看到“查询和数据库监控”以及“资源监控”选项。
- en: Query and database monitoring serverless
  id: totrans-51
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 无服务器的查询和数据库监控
- en: When you have to monitor workloads, most often it will be with respect to a
    specific namespace or workgroup. To filter the metrics for a specific serverless
    namespace or a workgroup, you can choose the specific namespace from the main
    dashboard either by clicking on the link or by filtering the namespace. This will
    display query and database resource metrics for that specific namespace.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 当你需要监控工作负载时，通常会针对特定的命名空间或工作组进行监控。要过滤特定的无服务器命名空间或工作组的指标，你可以从主仪表板上选择特定的命名空间，要么通过点击链接，要么通过筛选命名空间来进行。这将显示该特定命名空间的查询和数据库资源指标。
- en: Serverless query and database monitoring
  id: totrans-53
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 无服务器查询和数据库监控
- en: When you select “Query and database monitoring,” you can select the serverless
    workgroup to analyze the query and load workloads. Here you have options to monitor
    “Query history” or “Database performance,” as shown in [Figure 10-1](#monitoring_serverless_queries).
    Since serverless will autoscale and add RPU capacity as required up to the maximum
    RPU value configured, there is no need to monitor or manage the workload or workload
    concurrency as you saw in provisioned cluster. Under “Query history,” you can
    use the “Query runtime” graph to see which queries are running in the same timeframe,
    and choose a query to view more query execution details. You can also analyze
    and view details of a query’s completion status, duration, and SQL statement.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 当您选择“查询和数据库监控”时，可以选择无服务器工作组来分析查询和负载工作负载。在这里，您可以选择监控“查询历史记录”或“数据库性能”，如 [图 10-1](#monitoring_serverless_queries)
    所示。由于无服务器将根据需要自动缩放并添加 RPU 容量，直至配置的最大 RPU 值，因此无需像在提供的集群中那样监控或管理工作负载或工作负载并发。在“查询历史记录”下，您可以使用“查询运行时间”图来查看在相同时间段内运行的查询，选择一个查询来查看更多的查询执行详细信息。您还可以分析和查看查询的完成状态、持续时间和
    SQL 语句的详细信息。
- en: You also have the option for additional filters to choose time range, type of
    queries, and type of SQL commands used or to choose a specific user or database,
    as shown in [Figure 10-2](#monitoring_serverless_queries_filter).
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以选择额外的过滤器，选择时间范围、查询类型和使用的 SQL 命令类型，或选择特定的用户或数据库，如 [图 10-2](#monitoring_serverless_queries_filter)
    所示。
- en: '![Additional filter for Serverless Query and database monitoring](assets/ardg_1002.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![无服务器查询和数据库监控的额外过滤器](assets/ardg_1002.png)'
- en: Figure 10-2\. Serverless query and database monitoring additional filter
  id: totrans-57
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-2\. 无服务器查询和数据库监控的额外过滤器
- en: Serverless query monitoring drill-down query
  id: totrans-58
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 无服务器查询监控的深入展开查询
- en: You can further drill down on the Query ID to view the details of the query
    SQL, query plan, and related metrics, as shown in [Figure 10-3](#monitoring_serverless_querydetailsdrilldown_sql).
    The query plan will be based on the rewritten query, and the related metrics has
    the RPU capacity used and the active database connections used.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以进一步展开查询 ID，查看查询 SQL、查询计划和相关指标的详细信息，如 [图 10-3](#monitoring_serverless_querydetailsdrilldown_sql)
    所示。查询计划将基于重写后的查询，并且相关指标包括使用的 RPU 容量和活动数据库连接。
- en: '![Serverless Query monitoring drill-down](assets/ardg_1003.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![无服务器查询监控的深入展开](assets/ardg_1003.png)'
- en: Figure 10-3\. Serverless query monitoring drill down
  id: totrans-61
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-3\. 无服务器查询监控的深入展开
- en: Serverless query monitoring drill-down query plan
  id: totrans-62
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 无服务器查询监控的深入展开查询计划
- en: The query Plan screen in [Figure 10-4](#monitoring_serverless_querydetailsdrilldown_queryplan)
    shows the detailed plan of the query and the various streams and segments with
    the runtime of each stream and segment. In addition, you also see the input and
    output rows to determine where the bottleneck exists.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 10-4](#monitoring_serverless_querydetailsdrilldown_queryplan) 中的查询计划屏幕显示了查询的详细计划，以及各个流和段的运行时间。此外，您还可以看到输入和输出行，以确定瓶颈所在。'
- en: '![Serverless Query monitoring drill-down related metrics](assets/ardg_1004.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![无服务器查询监控深入展开的相关指标](assets/ardg_1004.png)'
- en: Figure 10-4\. Serverless query monitoring drill-down
  id: totrans-65
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-4\. 无服务器查询监控的深入展开
- en: Serverless query monitoring drill-down related metrics
  id: totrans-66
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 无服务器查询监控的深入展开相关指标
- en: The related metrics show the overall capacity used in RPUs in the last 10 hours
    and the number of active database connections to help you correlate the capacity
    used to the active database connections during that time. For example, in [Figure 10-5](#monitoring_serverless_querydetailsdrilldown_relatedmetrics)
    you see from 12:00 p.m. to 3:00 p.m. there were active database connections that
    were not executing any queries except for a brief period around 1:30 p.m. This
    is why the RPU capacity stays at zero for part of the time between 12:00 p.m.
    to 3:00 p.m.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 相关指标显示了过去10小时内使用的RPUs的总体容量，以及活跃数据库连接的数量，帮助您将此时段内的容量使用情况与活跃数据库连接相关联。例如，在[图 10-5](#monitoring_serverless_querydetailsdrilldown_relatedmetrics)
    中，您可以看到从下午12:00到下午3:00期间存在活跃的数据库连接，除了下午1:30左右的一个短暂时期未执行任何查询。这就是为什么RPUs容量在12:00到3:00之间的某些时间保持为零的原因。
- en: '![Serverless Query monitoring drill-down related metrics](assets/ardg_1005.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![服务器无服务查询监控详细指标](assets/ardg_1005.png)'
- en: Figure 10-5\. Serverless query monitoring drill down
  id: totrans-69
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-5\. 服务器无服务查询监控详细信息
- en: The details of the metrics for the serverless query and database monitoring
    are shown in [Table 10-2](#monitoring_metrics_serverless_query).
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器无服务查询和数据库监控的指标详细信息显示在[表 10-2](#monitoring_metrics_serverless_query) 中。
- en: Table 10-2\. Query and database monitoring metrics for serverless
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 表 10-2\. 服务器无服务查询和数据库监控指标
- en: '| Query/Database | Query/Resource | Metric | Details |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| 查询/数据库 | 查询/资源 | 指标 | 详细信息 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| Query history | Query list | Query runtime | Use this graph to see which
    queries are running in the same timeframe. Choose a query to view more query execution
    details. |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| 查询历史 | 查询列表 | 查询运行时间 | 使用此图表查看在同一时间段内运行的查询。选择一个查询以查看更多的查询执行细节。 |'
- en: '|  |  | Queries and loads | Query and load statistics with start time, duration
    |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '|  |  | 查询和负载 | 开始时间、持续时间的查询和负载统计 |'
- en: '|  | Resource metrics | Query runtime | Query to view more query execution
    details |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '|  | 资源指标 | 查询运行时间 | 查询查看更多的查询执行细节 |'
- en: '|  |  | RPU capacity used | Overall capacity in RPUs |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '|  |  | 使用的RPU容量 | RPUs的总体容量 |'
- en: '|  |  | Database connections | The number of active database connections |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '|  |  | 数据库连接 | 活跃数据库连接的数量 |'
- en: '| Database performance |  | Queries completed per second | The average number
    of queries completed per second |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
  zh: '| 数据库性能 |  | 每秒完成的查询数 | 每秒完成的平均查询数 |'
- en: '|  |  | Queries duration | The average amount of time to complete a query |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
  zh: '|  |  | 查询持续时间 | 完成查询的平均时间 |'
- en: '|  |  | Database connections | The number of active database connections |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '|  |  | 数据库连接 | 活跃数据库连接的数量 |'
- en: '|  |  | Running queries | Total number of running queries at a given time |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '|  |  | 正在运行的查询 | 特定时间正在运行的总查询数 |'
- en: '|  |  | Queued queries | Total number of queries queued at a given time |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '|  |  | 排队查询 | 特定时间排队的总查询数 |'
- en: '|  |  | RPU capacity used | Overall capacity in RPUs |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '|  |  | 使用的RPU容量 | RPUs的总体容量 |'
- en: '|  |  | Query runtime breakdown | The total time queries spent running by query
    type |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '|  |  | 查询运行时间分解 | 按查询类型运行的查询总时间 |'
- en: Resource monitoring
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 资源监控
- en: With Amazon Redshift serverless, compute capacity is measured in RPU, and each
    RPU corresponds to a related CPU and memory capacity. When you select “Resource
    monitoring” as shown in [Figure 10-6](#monitoring_serverless_resource) in the
    serverless console, you see two graphs; the first one shows the overall capacity
    in Redshift RPUs with timeline across the x-axis, and the second graph shows the
    cumulative usage of Redshift serverless by period. As discussed earlier, you can
    select the time range by expanding the Additional Filtering options. As you can
    see, the RPU capacity is provisioned only when workloads need to be processed;
    capacity drops down to zero after actual compute usage for workloads drop and
    it trails the compute usage pattern. Similarly, the RPU capacity leads the usage
    graph, as only when the query workloads start to come in to the serverless endpoint,
    the RPU capacity automatically scales up. This demonstrates that the RPU capacity
    scales automatically to meet the incoming workloads. A consistently large cumulative
    usage can be an indication that you can set a higher initial RPU for your serverless
    to get the workload executed faster, yet at the same cost.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Amazon Redshift 无服务器，计算容量以 RPU 表示，每个 RPU 对应于相关的 CPU 和内存容量。如无服务器控制台中所示选择“资源监控”，您将看到两个图表；第一个显示
    Redshift RPUs 的总容量随时间轴的变化，第二个图表显示了按期间累积使用的 Redshift 无服务器。正如前文讨论的，您可以通过扩展额外的过滤选项选择时间范围。正如您所见，只有当工作负载需要处理时才会配置
    RPU 容量；实际计算工作负载的使用量降低后，容量将降至零，并且跟踪计算使用模式。类似地，RPU 容量领先于使用图，仅当查询工作负载开始进入无服务器端点时，RPU
    容量才会自动扩展。这表明 RPU 容量会自动扩展以满足传入的工作负载。持续大量的累积使用可能表明您可以为无服务器设置更高的初始 RPU，以更快地执行工作负载，但成本相同。
- en: '![Serverless Resource monitoring](assets/ardg_1006.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![无服务器资源监控](assets/ardg_1006.png)'
- en: Figure 10-6\. Serverless resource monitoring
  id: totrans-89
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-6\. 无服务器资源监控
- en: The details of the metrics for the serverless resource monitoring are shown
    in [Table 10-3](#monitoring_metrics_serverless_resource).
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 无服务器资源监控度量的详细信息如 [表 10-3](#monitoring_metrics_serverless_resource) 所示。
- en: Table 10-3\. Resource monitoring for serverless
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 表 10-3\. 无服务器资源监控
- en: '| Metric | Details |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| --- | --- |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| RPU capacity used | Overall capacity in RPUs |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| 使用的 RPU 容量 | RPUs 的总容量 |'
- en: '| Compute usage | The accumulative usage of Redshift Serverless by period for
    the selected time range |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| 计算使用量 | 在所选时间范围内 Redshift 无服务器的累积使用情况 |'
- en: Monitoring Provisioned Data Warehouse Using Console
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用控制台监控预置数据仓库
- en: The main dashboard for Amazon Redshift provisioned data warehouse shows metrics
    across all clusters, and you have the option to select a specific provisioned
    data warehouse to monitor. As shown in [Figure 10-7](#monitoring_console_main_provisioned),
    you can switch between the various metrics to view queries, database connections,
    disk space, and CPU utilization.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Redshift 预置数据仓库的主仪表板显示所有集群的度量，并且您可以选择特定的预置数据仓库进行监控。如 [图 10-7](#monitoring_console_main_provisioned)
    所示，您可以在各种度量之间切换以查看查询、数据库连接、磁盘空间和 CPU 利用率。
- en: 'The performance data for provisioned clusters that you can view and monitor
    in the Amazon Redshift console falls into two categories:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在 Amazon Redshift 控制台中查看和监控的预置集群的性能数据分为两类：
- en: Data warehouse performance and resource utilization metrics
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据仓库性能和资源利用度量
- en: Query and data ingestion performance metrics
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查询和数据摄取性能度量
- en: With the data warehouse performance metrics, you can monitor the system resources
    and analyze if there is a need for scaling up or down. With query and ingestion
    metrics, you analyze how a certain workload has performed with the given resources.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 使用数据仓库性能度量，您可以监控系统资源，并分析是否需要扩展或缩小。通过查询和摄取度量，您可以分析在给定资源下某个工作负载的执行情况。
- en: '![Monitor provisioned cluster](assets/ardg_1007.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![监控预置集群](assets/ardg_1007.png)'
- en: Figure 10-7\. Monitor data warehouse performance
  id: totrans-103
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-7\. 监控数据仓库性能
- en: These metrics available in the main dashboard can be summarized as shown in
    [Table 10-4](#monitoring_metrics_provisioned_table).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 如 [表 10-4](#monitoring_metrics_provisioned_table) 所示，可以总结主仪表板中的这些度量。
- en: Table 10-4\. Monitoring metrics in main dashboard of provisioned cluster
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 表 10-4\. 监控预置集群主仪表板中的度量
- en: '| Metric | Details |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| 指标 | 详情 |'
- en: '| --- | --- |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| Cluster metrics | Number of queries |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| 集群度量 | 查询数 |'
- en: '|  | Database connections |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '|  | 数据库连接数 |'
- en: '|  | Disk space used |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '|  | 使用的磁盘空间 |'
- en: '|  | CPU utilization |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '|  | CPU 利用率 |'
- en: '| Query overview | Queries workloads (short, medium, and long) for specific
    time |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| 查询概述 | 查询工作负载（短期、中期和长期）以特定时间为基础 |'
- en: Data warehouse performance and resource utilization metrics
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 数据仓库性能和资源利用率指标
- en: Physical aspects of your cluster, such as CPU utilization, latency, and throughput
    are captured in Amazon CloudWatch. These metrics are displayed directly in the
    Amazon Redshift console, in context to the data warehouse you are viewing, as
    shown in [Figure 10-8](#monitoring_console_clusterperformance) for provisioned
    cluster. For monitoring serverless, you can jump to [“Monitoring and Administering
    Serverless”](#Monitoring-administering-serverless) for more details on resource
    monitoring. You can also view the same metrics in the CloudWatch console by creating
    dashboards and selecting the metrics you want to analyze. The details of these
    metrics are covered in [“Monitoring Using Amazon CloudWatch”](#Monitoring-using-cloudwatch).
    Alternatively, you can use AWS CLI or one of the AWS SDKs to consume the metrics
    using a custom web interface.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon CloudWatch 捕获您集群的物理方面，如 CPU 利用率、延迟和吞吐量。这些指标直接显示在 Amazon Redshift 控制台中，与您正在查看的数据仓库上下文相关，如图
    [10-8](#monitoring_console_clusterperformance) 所示，适用于预留的集群。对于监控无服务器，您可以跳转到 [“监控和管理无服务器”](#Monitoring-administering-serverless)
    了解更多资源监控详情。您还可以通过创建仪表板并选择要分析的指标，在 CloudWatch 控制台中查看相同的指标。这些指标的详细信息在 [“使用 Amazon
    CloudWatch 进行监控”](#Monitoring-using-cloudwatch) 中涵盖。或者，您可以使用 AWS CLI 或 AWS SDK
    之一通过自定义 Web 界面来消耗这些指标。
- en: '![Monitor data warehouse performance](assets/ardg_1008.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![监控数据仓库性能](assets/ardg_1008.png)'
- en: Figure 10-8\. Monitor data warehouse performance
  id: totrans-116
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-8\. 监控数据仓库性能
- en: When you size your provisioned data warehouse or set a base RPU for your serverless
    instance, you typically start with an estimate of your current data volume and
    the percentage of hot data. As your workloads and data volume grow, you can resize
    your data warehouse or increase the RPU. The data warehouse performance metrics
    in the Redshift console give you an indication of whether your data warehouse
    resources are underutilized or overutilized, and this data helps you monitor database
    activity and performance. The Redshift Advisor also analyzes your workloads and
    provides you with sizing recommendations.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 当您为预留数据仓库调整大小或为无服务器实例设置基础 RPU 时，通常从当前数据量的估计和热数据的百分比开始。随着工作负载和数据量的增长，您可以调整数据仓库的大小或增加
    RPU。Redshift 控制台中的数据仓库性能指标可让您了解数据仓库资源是过度利用还是未充分利用的指示，并且这些数据帮助您监控数据库活动和性能。Redshift
    顾问还分析您的工作负载并为您提供大小建议。
- en: 'By using data warehouse metrics in Amazon Redshift, you can do the following
    common performance tasks:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Amazon Redshift 中的数据仓库指标，您可以执行以下常见性能任务：
- en: Check for abnormal activity such as disk usage spikes, CPU usage, and query
    queue time by reviewing data warehouse metrics over a specified time range and
    identify the queries responsible for the anomalies. You can also check if these
    queries are contributing to degradation in system performance. You can then add
    relevant QMR in the parameter group WLM configuration for provisioned cluster
    or set query limits for the serverless workgroup for serverless.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检查数据仓库指标在指定时间范围内的异常活动，如磁盘使用率波动、CPU 使用率和查询队列时间，并识别引起异常的查询。您还可以检查这些查询是否导致系统性能下降。然后，您可以为预留的集群添加相关的
    QMR 到参数组 WLM 配置中，或者为无服务器工作组设置查询限制。
- en: Check if historical or current queries are impacting data warehouse performance.
    If you identify a problematic query, you can set QMR rules to prevent this query
    from impacting other workloads. You can then view details about the plan and the
    overall data warehouse performance during the query’s execution and use this information
    to diagnose why the query was slow and what can be done to improve its performance.
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检查历史或当前查询是否影响数据仓库的性能。如果确定存在问题的查询，您可以设置 QMR 规则，以防止此查询影响其他工作负载。然后，您可以在查询执行期间查看计划和整体数据仓库性能的详细信息，并利用此信息诊断查询为何缓慢以及如何改进其性能。
- en: View Performance Data
  id: totrans-121
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 查看性能数据
- en: To view performance data, you can login to the AWS Management Console and open
    the [Amazon Redshift console](https://oreil.ly/IxcVd). On the navigation menu,
    choose the provisioned clusters dashboard, then choose the name of a data warehouse
    from the list to open its details. The details of the data warehouse are displayed
    as shown in [Figure 10-9](#monitoring_choose_provisioned), which include Cluster
    performance, Query monitoring, Databases, Datashares, Schedules, Maintenance,
    and Properties tabs.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看性能数据，您可以登录AWS管理控制台并打开[Amazon Redshift控制台](https://oreil.ly/IxcVd)。在导航菜单中，选择预配置的集群仪表板，然后从列表中选择数据仓库的名称以打开其详细信息。数据仓库的详细信息如[图 10-9](#monitoring_choose_provisioned)所示，包括集群性能、查询监控、数据库、数据共享、调度、维护和属性标签。
- en: '![Choose Provisioned clusters dashboard](assets/ardg_1009.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![选择配置的集群仪表板](assets/ardg_1009.png)'
- en: Figure 10-9\. Choose the provisioned clusters dashboard
  id: totrans-124
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-9\. 选择预配置的集群仪表板
- en: Choose the Cluster performance tab to review the performance information as
    shown in [Table 10-5](#monitoring_metrics_provisioned_cluster_table).
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 选择“集群性能”标签以查看性能信息，如[表 10-5](#monitoring_metrics_provisioned_cluster_table)所示。
- en: Table 10-5\. Cluster performance metrics in dashboard of provisioned cluster
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 表 10-5\. 预配置集群仪表板中的集群性能指标
- en: '| Metrics | Details |'
  id: totrans-127
  prefs: []
  type: TYPE_TB
  zh: '| 指标 | 详情 |'
- en: '| --- | --- |'
  id: totrans-128
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| Alarms | CloudWatch alarms are triggered when a metric threshold is met.
    |'
  id: totrans-129
  prefs: []
  type: TYPE_TB
  zh: '| 告警 | 当满足度量阈值时，CloudWatch将触发告警。 |'
- en: '| Events | Events that occur on your cluster. |'
  id: totrans-130
  prefs: []
  type: TYPE_TB
  zh: '| 事件 | 发生在您的集群上的事件。 |'
- en: '| CPU utilization | The percentage of CPU utilization. |'
  id: totrans-131
  prefs: []
  type: TYPE_TB
  zh: '| CPU利用率 | CPU利用率百分比。 |'
- en: '| Percentage disk space used | The percent of disk space used. |'
  id: totrans-132
  prefs: []
  type: TYPE_TB
  zh: '| 使用的磁盘空间百分比 | 使用的磁盘空间百分比。 |'
- en: '| Auto vacuum space freed | Space reclaimed by auto vacuum in all tables. |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
  zh: '| 自动清理释放的空间 | 自动清理在所有表中回收的空间。 |'
- en: '| Database connections | The number of database connections to a cluster. |'
  id: totrans-134
  prefs: []
  type: TYPE_TB
  zh: '| 数据库连接 | 连接到集群的数据库连接数。 |'
- en: '| Health status | Indicates the health of the cluster. |'
  id: totrans-135
  prefs: []
  type: TYPE_TB
  zh: '| 健康状态 | 指示集群的健康状况。 |'
- en: '| Query duration | The average amount of time to complete a query. |'
  id: totrans-136
  prefs: []
  type: TYPE_TB
  zh: '| 查询持续时间 | 完成查询的平均时间。 |'
- en: '| Query throughput | The average number of queries completed per second. |'
  id: totrans-137
  prefs: []
  type: TYPE_TB
  zh: '| 查询吞吐量 | 每秒完成的平均查询数量。 |'
- en: '| Query duration per WLM queue | The average length of time to complete a query
    for a WLM queue. |'
  id: totrans-138
  prefs: []
  type: TYPE_TB
  zh: '| 每个WLM队列的查询持续时间 | 完成WLM队列的查询的平均时间长度。 |'
- en: '| Query throughput per WLM queue | The average number of queries completed
    per second for a WLM queue. |'
  id: totrans-139
  prefs: []
  type: TYPE_TB
  zh: '| 每个WLM队列的查询吞吐量 | 每秒完成的WLM队列的平均查询数量。 |'
- en: '| Concurrency scaling activity | Concurrency scaling usage limit. |'
  id: totrans-140
  prefs: []
  type: TYPE_TB
  zh: '| 并发缩放活动 | 并发缩放使用限制。 |'
- en: '| Usage limit for Redshift Spectrum | Redshift Spectrum usage limit. |'
  id: totrans-141
  prefs: []
  type: TYPE_TB
  zh: '| Redshift Spectrum的使用限制 | Redshift Spectrum使用限制。 |'
- en: You have the option to choose additional metrics and configure the dashboard
    to display the specific metrics that are important for you to monitor by clicking
    the Preferences button, as shown in [Figure 10-10](#monitoring_dbperf_preferences_button).
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过单击“首选项”按钮选择额外的指标并配置仪表板，以显示您需要监控的特定指标，如[图 10-10](#monitoring_dbperf_preferences_button)所示。
- en: '![Choose preferences for additional metrics](assets/ardg_1010.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![选择额外指标的首选项](assets/ardg_1010.png)'
- en: Figure 10-10\. Choose preferences for additional metrics
  id: totrans-144
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-10\. 选择额外指标的首选项
- en: Let’s take a look at some of these data warehouse metrics available and their
    corresponding graphs. For additional details related to performance metrics, you
    can refer to the [cluster performance data](https://oreil.ly/aKtuE).
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一些可用的数据仓库指标及其相应的图表。有关性能指标的详细信息，请参阅[集群性能数据](https://oreil.ly/aKtuE)。
- en: CPU utilization
  id: totrans-146
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: CPU利用率
- en: This metric shows the percentage of CPU utilization for all nodes (leader and
    compute). To find a time when the data warehouse usage is lowest before scheduling
    data warehouse migration or other resource-consuming operations, monitor this
    chart to see CPU utilization for each node. You can see the CPU utilization and
    percentage disk space used in [Figure 10-11](#monitoring_console_cpuutilization).
    When you see consistently high CPU utilization, that is an indication that your
    workloads could benefit from resizing the cluster. If the CPU utilization is sporadic
    with intermittent spikes, this could be a good case for cost savings with serverless.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 这个指标显示所有节点（领导节点和计算节点）的CPU利用率百分比。在安排数据仓库迁移或其他资源消耗型操作之前，可以监控此图表以查看每个节点的CPU利用率，找到数据仓库使用最低的时间点。您可以查看图 10-11中的CPU利用率和磁盘使用百分比。如果您持续看到高CPU利用率，这表明您的工作负载可能会受益于调整集群大小。如果CPU利用率时断时续并伴有间歇性波动，则这可能是使用无服务器进行成本节约的良好案例。
- en: '![Monitor CPU utilization](assets/ardg_1011.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![监视CPU利用率](assets/ardg_1011.png)'
- en: Figure 10-11\. Monitor CPU utilization
  id: totrans-149
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-11\. 监视CPU利用率
- en: Percentage disk space used
  id: totrans-150
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 磁盘空间使用百分比
- en: This metric shows the percentage of disk space usage per each compute node,
    and not for the data warehouse as a whole, as shown in [Figure 10-12](#monitoring_console_diskspaceused).
    You can explore this chart to monitor the disk utilization and estimate if you
    need to resize. When you use RA3 nodes, each node of ra3.4xl and ra3.16xl can
    store up to 128 TB, and ra3.xlplus can store up to 32 TB. So, you can store a
    large volume of data, but for resizing you should consider your compute requirements
    as well.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 这个指标显示每个计算节点的磁盘空间使用百分比，而不是整个数据仓库，如[图 10-12](#monitoring_console_diskspaceused)所示。您可以查看此图表来监控磁盘利用率，并估算是否需要调整大小。当您使用RA3节点时，每个ra3.4xl和ra3.16xl节点可以存储高达128
    TB，ra3.xlplus可以存储高达32 TB。因此，您可以存储大量数据，但在调整大小时，还应考虑您的计算需求。
- en: Maintenance operations like `VACUUM` and `COPY` use intermediate temporary storage
    space for their sort operations, so a spike in disk usage is expected.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 维护操作如`VACUUM`和`COPY`使用中间临时存储空间进行排序操作，因此预期磁盘使用率会出现波动。
- en: '![Monitor disk space used](assets/ardg_1012.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![监视磁盘空间使用](assets/ardg_1012.png)'
- en: Figure 10-12\. Monitor disk space used
  id: totrans-154
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-12\. 监视磁盘空间使用
- en: Database connections
  id: totrans-155
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 数据库连接数
- en: This shows the number of database connections to a cluster, as shown in [Figure 10-13](#monitoring_console_dbconnections).
    You can use this chart to see how many connections are established to the database
    and find a time when the data warehouse usage is lowest. You can also correlate
    the DB connections with the query metrics like query duration and query throughput,
    and analyze if the number of database connections have an impact on the query
    workloads.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 这显示了对群集的数据库连接数，如[图 10-13](#monitoring_console_dbconnections)所示。您可以使用此图表查看连接到数据库的连接数，并找到数据仓库使用最低的时间点。您还可以将数据库连接与查询持续时间和查询吞吐量等查询指标进行关联，并分析数据库连接数是否对查询工作负载产生影响。
- en: '![Monitor DB connections](assets/ardg_1013.png)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![监视数据库连接](assets/ardg_1013.png)'
- en: Figure 10-13\. Monitor DB connections
  id: totrans-158
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-13\. 监视数据库连接
- en: Query duration
  id: totrans-159
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 查询持续时间
- en: This metric shows the average amount of time to complete a query in microseconds,
    as shown in [Figure 10-14](#monitoring_console_queryduration). You can benchmark
    the data on this chart to measure I/O performance within the data warehouse and
    tune its most time-consuming queries if necessary.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 这个指标显示完成查询所需的平均时间（以微秒为单位），如[图 10-14](#monitoring_console_queryduration)所示。您可以在此图表上的数据进行基准测试，以衡量数据仓库内的I/O性能，并在必要时调整最耗时的查询。
- en: '![Monitor query duration](assets/ardg_1014.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![监视查询持续时间](assets/ardg_1014.png)'
- en: Figure 10-14\. Monitor query duration
  id: totrans-162
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-14\. 监视查询持续时间
- en: Query throughput
  id: totrans-163
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 查询吞吐量
- en: This metric shows the average number of completed queries per second, as shown
    in [Figure 10-15](#monitoring_console_throughput). You can analyze data on this
    chart to measure database performance and characterize the ability of the system
    to support a multiuser workload in a balanced way.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 这个指标显示每秒完成的平均查询数，如[图 10-15](#monitoring_console_throughput)所示。您可以分析此图表上的数据来衡量数据库性能，并评估系统支持多用户工作负载的能力。
- en: '![Monitor query throughput](assets/ardg_1015.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![监视查询吞吐量](assets/ardg_1015.png)'
- en: Figure 10-15\. Monitor query throughput
  id: totrans-166
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-15\. 监视查询吞吐量
- en: 'Query and data ingestion performance metrics: Query Monitoring tab'
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 查询和数据接入性能指标：查询监控选项卡
- en: The Amazon Redshift console provides information about the performance of queries
    that run in the data warehouse. When you have users complaining of query performance
    issues, and you need to be able to identify the reasons for slow performance,
    you can use the query monitoring dashboard to isolate the query performance problems.
    You can also compare query runtime metrics and data warehouse performance metrics
    on the same timeline to identify if there is a correlation between the data warehouse
    resources and the impact in performance. This helps you identify poorly performing
    queries, look for bottleneck queries, and determine if you need to resize your
    data warehouse for your workload.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Redshift 控制台提供有关在数据仓库中运行的查询性能的信息。当用户投诉查询性能问题时，您可以使用查询监控仪表板来分离查询性能问题的原因。您还可以比较查询运行时指标和数据仓库性能指标以确定它们在相同时间轴上的关联性，以帮助您识别性能不佳的查询、寻找瓶颈查询，并确定是否需要调整数据仓库以适应工作负载。
- en: This data is aggregated in the Amazon Redshift console to help you easily correlate
    what you see in performance metrics with specific database query and load events,
    as shown in [Figure 10-16](#monitoring_console_queryperformance_provisioned).
    For serverless, you can refer to [Figure 10-1](#monitoring_serverless_queries)
    for query and database monitoring.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 这些数据在 Amazon Redshift 控制台中聚合，帮助您轻松将性能指标与特定数据库查询和负载事件进行关联，如 [图 10-16](#monitoring_console_queryperformance_provisioned)
    所示。对于无服务器，您可以参考 [图 10-1](#monitoring_serverless_queries) 进行查询和数据库监控。
- en: Single-AZmance data is displayed only in the Amazon Redshift console, and is
    not published as CloudWatch metrics.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 单一区域数据仅在 Amazon Redshift 控制台中显示，并未作为 CloudWatch 指标发布。
- en: '![Monitor query performance in provisioned cluster](assets/ardg_1016.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![监控预置集群中的查询性能](assets/ardg_1016.png)'
- en: Figure 10-16\. Monitor query performance
  id: totrans-172
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-16\. 监控查询性能
- en: The details of the query and data ingestion performance metrics are shown in
    [Table 10-6](#monitoring_metrics_provisioned_query_table).
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 查询和数据摄取性能指标的详细信息显示在 [表 10-6](#monitoring_metrics_provisioned_query_table) 中。
- en: Table 10-6\. Query monitoring metrics in the data warehouse dashboard of provisioned
    cluster
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 表格 10-6\. 预置集群数据仓库仪表板中的查询监控指标
- en: '| Monitoring | Metrics | Details |'
  id: totrans-175
  prefs: []
  type: TYPE_TB
  zh: '| 监控 | 指标 | 详情 |'
- en: '| --- | --- | --- |'
  id: totrans-176
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Query history | Query runtime | The query activity on a timeline. Use this
    graph to see which queries are running in the same timeframe. Choose a query to
    view more query execution details. |'
  id: totrans-177
  prefs: []
  type: TYPE_TB
  zh: '| 查询历史记录 | 查询运行时 | 时间轴上的查询活动。使用此图表查看在同一时间段内运行的查询。选择一个查询以查看更多查询执行详情。 |'
- en: '|  | Queries and loads | Query execution details. |'
  id: totrans-178
  prefs: []
  type: TYPE_TB
  zh: '|  | 查询和负载 | 查询执行详细信息。 |'
- en: '| Database performance | Workload execution breakdown | The time used in query
    processing stages. |'
  id: totrans-179
  prefs: []
  type: TYPE_TB
  zh: '| 数据库性能 | 工作负载执行细分 | 查询处理阶段使用的时间。 |'
- en: '|  | Queries by duration range | The number of short, medium, and long queries.
    |'
  id: totrans-180
  prefs: []
  type: TYPE_TB
  zh: '|  | 按持续时间范围分类的查询 | 短、中、长查询的数量。 |'
- en: '|  | Query throughput | The average number of queries completed per second.
    |'
  id: totrans-181
  prefs: []
  type: TYPE_TB
  zh: '|  | 查询吞吐量 | 每秒完成的平均查询数量。 |'
- en: '|  | Query duration | The average amount of time to complete a query. |'
  id: totrans-182
  prefs: []
  type: TYPE_TB
  zh: '|  | 查询持续时间 | 完成查询所需的平均时间。 |'
- en: '|  | Average queue wait time by priority | The total time queries spent waiting
    in the WLM queue by query priority. |'
  id: totrans-183
  prefs: []
  type: TYPE_TB
  zh: '|  | 按优先级平均队列等待时间 | 查询优先级中查询在 WLM 队列中等待的总时间。 |'
- en: '| Workload concurrency | Queued versus Running queries on the cluster | The
    number of queries running (from the main data warehouse and Concurrency Scaling
    cluster) compared to the number of queries waiting in all WLM queues in the cluster.
    |'
  id: totrans-184
  prefs: []
  type: TYPE_TB
  zh: '| 工作负载并发性 | 集群上排队与运行的查询对比 | 运行中的查询数量（来自主数据仓库和并发扩展集群）与集群中所有 WLM 队列中等待的查询数量对比。'
- en: Query history at data warehouse level
  id: totrans-185
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 数据仓库级别的查询历史记录
- en: To display query history for a specific cluster, you choose the data warehouse
    by clicking on the link for the specific cluster, then choose the Query monitoring
    tab. You will see three tabs for Query history, Database performance, and Workload
    concurrency, as shown in [Figure 10-17](#monitoring_console_queryperformance).
    Here you choose the Query history tab, and you can toggle between query list and
    cluster metrics using buttons on the window.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 要显示特定集群的查询历史记录，您可以通过单击特定集群的链接选择数据仓库，然后选择“查询监控”选项卡。您将看到“查询历史记录”、“数据库性能”和“工作负载并发性”三个选项卡，如
    [图 10-17](#monitoring_console_queryperformance) 所示。在此处选择“查询历史记录”选项卡，并可以使用窗口上的按钮在查询列表和集群指标之间切换。
- en: 'When you choose Query List, the tab includes the following graphs:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 当您选择“查询列表”时，选项卡中包含以下图表：
- en: Query runtime
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 查询运行时间
- en: This shows query activity on a timeline (see [Figure 10-17](#monitoring_console_queryperformance)).
    Use this graph to see which queries are running in the same timeframe. Choose
    a query to view more query execution details. The x-axis shows the selected period.
    You can filter the graphed queries by running, completed, loads, and so on. Each
    horizontal bar represents a query, and the length of the bar represents its runtime
    from the start of the bar to the end. The queries can include SQL data manipulation
    statements (such as `SELECT`, `INSERT`, `DELETE`) and loads (such as `COPY`).
    By default, the top 100 longest-running queries are shown for the selected time
    period.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示了时间轴上的查询活动（请参见[图 10-17](#monitoring_console_queryperformance)）。使用此图可查看在相同时间段内运行的查询。选择一个查询以查看更多的查询执行详情。X轴显示了所选周期。您可以通过运行、完成、加载等方式过滤图表中的查询。每个水平条代表一个查询，条的长度表示从条的开始到结束的运行时间。查询可以包括SQL数据操作语句（例如`SELECT`、`INSERT`、`DELETE`）和加载（例如`COPY`）。默认情况下，显示所选时间段内前100个运行时间最长的查询。
- en: '![Monitor query performance](assets/ardg_1017.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![监控查询性能](assets/ardg_1017.png)'
- en: Figure 10-17\. Query monitoring performance
  id: totrans-191
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-17\. 查询监控性能
- en: Queries and loads
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 查询和加载
- en: This shows a list of queries and loads that ran on the cluster (see [Figure 10-18](#monitoring_console_qryperf_loads)),
    where you can also drill down into the Query ID to view the query plan to further
    analyze the query. You also have an option to terminate a query here.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示了在集群上运行的查询和加载的列表（请参见[图 10-18](#monitoring_console_qryperf_loads)），您还可以深入到查询ID查看查询计划以进一步分析查询。您还可以选择在此终止查询。
- en: '![Query monitoring loads](assets/ardg_1018.png)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![查询监控加载](assets/ardg_1018.png)'
- en: Figure 10-18\. Query monitoring loads
  id: totrans-195
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-18\. 查询监控加载
- en: 'When you choose “Cluster metrics,” the tab includes the following graph, as
    shown in [Figure 10-19](#monitoring_database_performance):'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 当您选择“集群指标”时，选项卡中包含以下图表，如[图 10-19](#monitoring_database_performance)所示：
- en: Query runtime
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 查询运行时间
- en: This shows the query activity on a timeline. Use this graph to see which queries
    are running in the same timeframe. Choose a query to view more query execution
    details.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示了时间轴上的查询活动。使用此图可查看在相同时间段内运行的查询。选择一个查询以查看更多的查询执行详情。
- en: CPU utilization
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: CPU利用率
- en: This shows the CPU utilization of the data warehouse by leader node and average
    of compute nodes.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示了数据仓库通过主节点和计算节点的CPU利用率的情况及其平均值。
- en: Storage capacity used
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 已使用的存储容量
- en: This shows the percent of the storage capacity used.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示了已使用的存储容量的百分比。
- en: Active database connections
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 活跃的数据库连接
- en: This shows the number of active database connections to the cluster.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示了连接到集群的活跃数据库连接数。
- en: '![Monitor database performance](assets/ardg_1019.png)'
  id: totrans-205
  prefs: []
  type: TYPE_IMG
  zh: '![监控数据库性能](assets/ardg_1019.png)'
- en: Figure 10-19\. Monitor database performance
  id: totrans-206
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-19\. 监控数据库性能
- en: Database performance for queries
  id: totrans-207
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 查询的数据库性能
- en: 'The database performance metrics has details on where the query time is spent
    either in plan, wait, commit, or execution and the throughput of the database.
    These metrics are available under two tabs, “Cluster metrics” and “WLM queue metrics,”
    and you can use database performance metrics in Amazon Redshift to do the following:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库性能指标详细说明了查询时间在计划、等待、提交或执行中的花费位置以及数据库的吞吐量。这些指标在“集群指标”和“WLM队列指标”两个选项卡下可用，您可以使用Amazon
    Redshift的数据库性能指标执行以下操作：
- en: Analyze the time spent by queries by processing stages, and look for unusual
    trends like high query wait time, runtime, or execution time where the amount
    of time spent in a stage is large.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析查询通过处理阶段花费的时间，并查找异常趋势，例如高查询等待时间、运行时间或执行时间，其中在某个阶段花费的时间较长。
- en: 'Filter based on query status: running, completed, failed, or stopped queries.'
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于查询状态进行过滤：正在运行的、已完成的、失败的或停止的查询。
- en: 'Analyze the number of queries, duration, and throughput of queries by duration
    ranges (short: < 10 seconds, medium: 10 seconds to 10 minutes, long: > 10 minutes).'
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析查询数量、持续时间以及查询通过不同持续时间范围的吞吐量（短：< 10秒、中等：10秒至10分钟、长：> 10分钟）。
- en: Look for trends in query wait time by query priority (Lowest, Low, Normal, High,
    Highest, Critical). With workload management (WLM), you can set up multiple queues
    with different priorities, as we covered in [“WLM, Queues, and QMR”](ch05.html#wlm_qmr).
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查找按查询优先级（最低、低、普通、高、最高、关键）排序的查询等待时间的趋势。通过工作负载管理（WLM），您可以设置具有不同优先级的多个队列，我们在[“WLM、队列和QMR”](ch05.html#wlm_qmr)中进行了介绍。
- en: Look for trends in the query duration, throughput, or wait time by WLM queue.
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查找 WLM 队列中查询持续时间、吞吐量或等待时间的趋势。
- en: 'We discuss some of the example graphs next:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来我们将讨论一些示例图表：
- en: Workload execution breakdown
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 工作负载执行分解
- en: This graph shows the time used in the query processing stages plan, wait, commit,
    and actual execution (see [Figure 10-20](#monitoring_dbperf_wrkload_breakdown)).
    You can determine if a particular query or queries are spending too much time
    in a wait state. This detail will help you evaluate if you need to resize your
    cluster. In this case, turning on Concurrency Scaling might be helpful.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示了查询处理阶段计划、等待、提交和实际执行所用的时间（参见 [图 10-20](#monitoring_dbperf_wrkload_breakdown)）。您可以确定特定查询或查询是否在等待状态中花费了太多时间。这些细节将帮助您评估是否需要调整集群大小。在这种情况下，打开并发缩放可能会有所帮助。
- en: '![Workload execution breakdown](assets/ardg_1020.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![工作负载执行分解](assets/ardg_1020.png)'
- en: Figure 10-20\. Workload execution breakdown
  id: totrans-218
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-20\. 工作负载执行分解
- en: Queries by duration range
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 查询按持续时间范围
- en: This graph, as shown in [Figure 10-21](#monitoring_dbperf_qrydur_range), shows
    the number of short, medium, and long queries.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 此图表显示了短期、中期和长期查询的数量，如 [图 10-21](#monitoring_dbperf_qrydur_range) 所示。
- en: '![Queries by duration range](assets/ardg_1021.png)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![按持续时间范围的查询](assets/ardg_1021.png)'
- en: Figure 10-21\. Queries by duration range
  id: totrans-222
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-21\. 按持续时间范围的查询
- en: Query throughput
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 查询吞吐量
- en: This graph, as shown in [Figure 10-22](#monitoring_dbperf_qry_thruput), shown
    an average number of queries completed per second.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 此图表显示了每秒完成的平均查询数量，如 [图 10-22](#monitoring_dbperf_qry_thruput) 所示。
- en: '![Query throughput](assets/ardg_1022.png)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![查询吞吐量](assets/ardg_1022.png)'
- en: Figure 10-22\. Query throughput
  id: totrans-226
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-22\. 查询吞吐量
- en: Query duration
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 查询持续时间
- en: '[Figure 10-23](#monitoring_dbperf_qry_dur) shows the average amount of time
    to complete a query.'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 10-23](#monitoring_dbperf_qry_dur) 显示了完成查询所需的平均时间。'
- en: '![Query duration](assets/ardg_1023.png)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
  zh: '![查询持续时间](assets/ardg_1023.png)'
- en: Figure 10-23\. Query duration
  id: totrans-230
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-23\. 查询持续时间
- en: Average queue wait time by priority
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 按优先级平均队列等待时间
- en: The graph in [Figure 10-24](#monitoring_dbperf_queue_waittime) shows the total
    time queries spent waiting in the WLM queue by query priority.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 10-24](#monitoring_dbperf_queue_waittime) 中的图表显示了查询按查询优先级在 WLM 队列中等待的总时间。'
- en: '![Average queue wait time by priority](assets/ardg_1024.png)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![按优先级平均队列等待时间](assets/ardg_1024.png)'
- en: Figure 10-24\. Average queue wait time by priority
  id: totrans-234
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-24\. 按优先级平均队列等待时间
- en: Query throughput by queue
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 按队列查询吞吐量
- en: This graph, as shown in [Figure 10-25](#monitoring_dbperf_thruput_byqueue),
    shows the query runtime and throughput for each of the WLM queues.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 此图表显示了每个 WLM 队列的查询运行时间和吞吐量，如 [图 10-25](#monitoring_dbperf_thruput_byqueue) 所示。
- en: '![Query throughput by queue](assets/ardg_1025.png)'
  id: totrans-237
  prefs: []
  type: TYPE_IMG
  zh: '![按队列查询吞吐量](assets/ardg_1025.png)'
- en: Figure 10-25\. Query throughput by queue
  id: totrans-238
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-25\. 按队列查询吞吐量
- en: Workload concurrency
  id: totrans-239
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 工作负载并发
- en: 'You learned in [Figure 5-3](ch05.html#concurrency_scaling_5_2) that you can
    use the Concurrency Scaling feature to automatically scale compute capacity to
    meet the requirements of your dynamic workloads. The workload concurrency tab
    provides metrics related to Concurrency Scaling and helps you understand the following:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [图 5-3](ch05.html#concurrency_scaling_5_2) 中学习到，您可以使用并发缩放功能自动扩展计算能力，以满足动态工作负载的要求。工作负载并发选项卡提供与并发缩放相关的度量，并帮助您理解以下内容：
- en: Analyze if enabling Concurrency Scaling will help reduce the number of queued
    queries by comparing the queued versus running queries in all WLM queues.
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过比较所有 WLM 队列中排队与运行查询的数量，分析启用并发缩放是否有助于减少排队查询的数量。
- en: View Concurrency Scaling activity in Concurrency Scaling clusters and determine
    if Concurrency Scaling is limited to the max_concurrency_scaling_clusters. This
    will give you an indication of whether you should choose to increase the max_concurrency_scaling_clusters
    in the parameter group for the cluster.
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看并发缩放集群中的并发缩放活动，并确定并发缩放是否限制在 max_concurrency_scaling_clusters。这将为您提供是否应选择增加集群参数组中的
    max_concurrency_scaling_clusters 的指示。
- en: View the total usage of Concurrency Scaling across all Concurrency Scaling clusters
    to determine the impact on cost of enabling Concurrency Scaling.
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看所有并发缩放集群中并发缩放的总使用情况，以确定启用并发缩放对成本的影响。
- en: 'For serverless this happens automatically, and you need to analyze only the
    “compute capacity.” The “query runtime breakdown” in serverless has query waiting
    metrics, which you can use to analyze if you have to increase the base RPU. We
    discuss some of the graphs available for monitoring impact of Concurrency Scaling
    next:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 对于无服务器，这是自动发生的，您只需要分析“计算容量”。无服务器中的“查询运行时间分解”具有查询等待指标，您可以使用这些指标来分析是否需要增加基础RPU。接下来我们将讨论一些用于监视并发缩放影响的图表：
- en: Queued versus Running queries on the cluster
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 集群中排队与运行的查询
- en: '[Figure 10-26](#monitoring_wrkld_queued_vs_running_queries) shows the number
    of queries running compared to the number of queries waiting in all WLM queues
    in the cluster. This metric includes all queries running in the main and the Concurrency
    Scaling cluster.'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: '[图10-26](#monitoring_wrkld_queued_vs_running_queries)显示了集群中所有WLM队列中正在运行的查询数量与等待的查询数量的对比。此指标包括主要集群和并发缩放集群中正在运行的所有查询。'
- en: '![Queued versus Running queries on the cluster](assets/ardg_1026.png)'
  id: totrans-247
  prefs: []
  type: TYPE_IMG
  zh: '![集群中排队与运行的查询之间的队列](assets/ardg_1026.png)'
- en: Figure 10-26\. Queued versus Running queries on the cluster
  id: totrans-248
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图10-26\. 集群中排队与运行的查询
- en: Queued versus Running queries per queue
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 每个队列中排队与运行的查询
- en: '[Figure 10-27](#monitoring_wrkld_queued_vs_running_perqueue) shows the number
    of queries running compared to the number of queries waiting in each WLM queue.'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '[图10-27](#monitoring_wrkld_queued_vs_running_perqueue)显示了每个WLM队列中正在运行的查询数量与等待的查询数量的对比。'
- en: '![Queued versus Running queries per queue](assets/ardg_1027.png)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
  zh: '![排队与运行查询之间的队列](assets/ardg_1027.png)'
- en: Figure 10-27\. Queued versus Running queries per queue
  id: totrans-252
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图10-27\. 每个队列中排队与运行的查询
- en: Concurrency scaling activity
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 并发缩放活动
- en: '[Figure 10-28](#monitoring_wrkld_concscal_activity) shows the number of Concurrency
    Scaling clusters that are actively processing queries. You can use this metric
    to understand if you need to increase the number of Concurrency Scaling clusters
    or set any usage limit.'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '[图10-28](#monitoring_wrkld_concscal_activity)显示了正在主动处理查询的并发缩放集群的数量。您可以使用此指标来了解是否需要增加并发缩放集群的数量或设置任何使用限制。'
- en: '![Concurrency scaling activity](assets/ardg_1028.png)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
  zh: '![并发缩放活动](assets/ardg_1028.png)'
- en: Figure 10-28\. Concurrency scaling activity
  id: totrans-256
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图10-28\. 并发缩放活动
- en: Concurrency scaling usage
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 并发缩放使用情况
- en: '[Figure 10-29](#monitoring_wrkld_concscal_usage) shows the usage of Concurrency
    Scaling clusters that have active query processing activity.'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: '[图10-29](#monitoring_wrkld_concscal_usage)显示了具有活动查询处理活动的并发缩放集群的使用情况。'
- en: '![Concurrency scaling usage](assets/ardg_1029.png)'
  id: totrans-259
  prefs: []
  type: TYPE_IMG
  zh: '![并发缩放使用情况](assets/ardg_1029.png)'
- en: Figure 10-29\. Concurrency scaling usage
  id: totrans-260
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图10-29\. 并发缩放使用情况
- en: Monitoring Queries and Loads Across Clusters
  id: totrans-261
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 跨集群监控查询和负载
- en: There is more than one way to monitor queries and loads in the console. To analyze
    queries and loads across clusters, you can select “Queries and loads” from the
    main Amazon Redshift console menu, as shown in [Figure 10-30](#monitoring_queries_loads).
    Here you can analyze and view query details, which includes the query’s completion
    status, duration, SQL statement, and whether it’s a user query or one that was
    rewritten by Amazon Redshift.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 在控制台中，有多种监控查询和负载的方式。要分析跨集群的查询和负载，您可以从主要的Amazon Redshift控制台菜单中选择“查询和负载”，如[图10-30](#monitoring_queries_loads)所示。在这里，您可以分析和查看查询详情，包括查询的完成状态、持续时间、SQL语句以及是否为用户查询或由Amazon
    Redshift重写的查询。
- en: A user query is a query submitted to Amazon Redshift either from an SQL client
    or generated by a BI tool. Amazon Redshift might rewrite the query to optimize
    it, and this can result in multiple rewritten queries. For example, with the Auto
    MV feature, when you write a query on the base tables, Redshift might create a
    materialized view and rewrite the query to run against the materialized view instead.
    Similarly, if you already have a materialized view and you have the query written
    on the base table, the query processor will rewrite the query to read from the
    existing materialized view. You can view the rewritten queries on the query details
    page in the console along with the initial user query.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 用户查询是从SQL客户端提交到Amazon Redshift的查询，或由BI工具生成的查询。Amazon Redshift可能会重写查询以对其进行优化，这可能会导致多个重写查询。例如，使用自动MV功能时，当您在基本表上编写查询时，Redshift可能会创建一个物化视图，并重写查询以针对物化视图而不是基本表运行。类似地，如果您已有一个物化视图，并且您在基本表上编写查询，查询处理器将重写查询以从现有的物化视图中读取。您可以在控制台上的查询详情页面上查看重写的查询以及最初的用户查询。
- en: Monitoring queries and loads
  id: totrans-264
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 监控查询和负载
- en: In the screen shown in [Figure 10-30](#monitoring_queries_loads), you can select
    the data warehouse for which to analyze the query workloads, and you can filter
    based on date/time range or status of queries. These filters can include top 100
    queries, completed queries, and failed or stopped queries. The list of filters
    is also shown.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 在显示中的屏幕中 [图 10-30](#monitoring_queries_loads)，您可以选择要分析查询工作负载的数据仓库，并可以基于日期/时间范围或查询状态进行过滤。这些过滤器可以包括前
    100 个查询、已完成的查询以及失败或停止的查询。过滤器列表也显示在此处。
- en: '![Monitoring queries and loads](assets/ardg_1030.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![监控查询和负载](assets/ardg_1030.png)'
- en: Figure 10-30\. Monitoring queries and loads
  id: totrans-267
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-30\. 监控查询和负载
- en: The console allows you to drill down to the details of a specific query by clicking
    on the Query ID link. When Query ID and other properties are displayed in a row
    below the graph, then you can choose the query to see details like the query’s
    SQL statement, execution details, and query plan, as shown in [Figure 10-31](#monitoring_queries_loads_plan).
    The “Query details” page shows you the parent query and all rewritten queries
    for read and write workloads for your analysis.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 控制台允许您通过单击查询 ID 链接来深入了解特定查询的详细信息。当查询 ID 和其他属性显示在图表下方的行中时，您可以选择查询以查看诸如查询的 SQL
    语句、执行详细信息和查询计划等详细信息，如 [图 10-31](#monitoring_queries_loads_plan) 所示。 "查询详情" 页面显示了用于分析的读写工作负载的父查询和所有重写查询。
- en: '![View Query details and Query plan](assets/ardg_1031.png)'
  id: totrans-269
  prefs: []
  type: TYPE_IMG
  zh: '![查看查询详情和查询计划](assets/ardg_1031.png)'
- en: Figure 10-31\. Monitoring query plan
  id: totrans-270
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-31\. 监控查询计划
- en: Monitoring top queries
  id: totrans-271
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 监控顶级查询
- en: By default, the “Query monitoring” page shows the top 100 longest queries by
    runtime or duration for the selected time window. You can change the time window
    to view the top queries for that period (see [Figure 10-32](#monitoring_top_queries)).
    The top queries also include completed queries and running queries. The completed
    queries are sorted by descending order of query runtime or duration.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，“查询监控” 页面显示所选时间窗口内按运行时间或持续时间排序的前 100 个最长查询。您可以更改时间窗口以查看该时段内的前查询 (见 [图 10-32](#monitoring_top_queries))。前查询还包括已完成的查询和运行中的查询。已完成的查询按查询运行时间或持续时间的降序排序。
- en: '![Monitoring top queries](assets/ardg_1032.png)'
  id: totrans-273
  prefs: []
  type: TYPE_IMG
  zh: '![监控顶级查询](assets/ardg_1032.png)'
- en: Figure 10-32\. Monitoring top queries
  id: totrans-274
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-32\. 监控顶级查询
- en: Identifying Systemic Query Performance Problems
  id: totrans-275
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 识别系统性查询性能问题
- en: Consider a scenario where many of your users are complaining about longer-than-normal
    query runtimes. You want to diagnose what is happening in your cluster. You can
    customize your time and switch to the graph view, which helps you correlate longer
    runtimes with what is happening in the cluster. As the Gantt chart and CPU utilization
    graph in [Figure 10-33](#monitoring_troubleshoot_systemic_query_perfomance) show,
    many queries were running at the time when CPU utilization almost reached a peak
    of 25%.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑这样一个场景，您的许多用户抱怨查询运行时间比正常情况长。您想诊断集群中发生了什么。您可以自定义时间并切换到图形视图，这有助于您将更长的运行时间与集群中发生的情况相关联。正如
    [图 10-33](#monitoring_troubleshoot_systemic_query_perfomance) 中的甘特图和 CPU 利用率图所示，许多查询在
    CPU 利用率几乎达到 25% 的时候运行。
- en: '![Identifying systemic query performance problems](assets/ardg_1033.png)'
  id: totrans-277
  prefs: []
  type: TYPE_IMG
  zh: '![识别系统性查询性能问题](assets/ardg_1033.png)'
- en: Figure 10-33\. Query duration
  id: totrans-278
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-33\. 查询持续时间
- en: Monitoring Using Amazon CloudWatch
  id: totrans-279
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Amazon CloudWatch 进行监控
- en: '[Amazon CloudWatch](https://aws.amazon.com/cloudwatch) is a monitoring service
    that monitors and captures alarms, logs, and events from various services in AWS.
    You can use Amazon CloudWatch to monitor and track various physical aspects of
    your cluster, such as CPU utilization, latency, and throughput of your resources
    and applications.'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '[Amazon CloudWatch](https://aws.amazon.com/cloudwatch) 是一个监控服务，可监控和捕获来自 AWS
    各种服务的警报、日志和事件。您可以使用 Amazon CloudWatch 监控和跟踪集群的各种物理方面，如 CPU 利用率、延迟和资源及应用程序的吞吐量。'
- en: You can create a dashboard using the automatic templates available or create
    a custom dashboard with the metrics you want to monitor. There is an an automatic
    dashboard for Amazon Redshift that you can use as a template. Note that some performance
    metrics are displayed in different scaled units in CloudWatch compared to the
    console. For example, the WriteThroughput metric is displayed in GBs compared
    to bytes in CloudWatch, which is a more relevant unit for the typical storage
    space of a node.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用可用的自动模板创建仪表板，也可以使用您希望监控的指标创建自定义仪表板。Amazon Redshift 还有一个自动仪表板可用作模板。请注意，与控制台相比，CloudWatch
    中显示的某些性能指标具有不同的比例单位。例如，WriteThroughput 指标以 GB 为单位显示，而控制台上以字节显示，这是节点的典型存储空间的更相关单位。
- en: You can create alarms to monitor metrics and send notifications when a limit
    or threshold is breached. You can also set up to automatically make changes to
    the resources based on a threshold; for example, you can monitor the CPU usage
    and query throughput or waiting in your Amazon Redshift data warehouse and then
    use that data to determine whether you should resize your cluster up or down.
    You can also use this data to pause or resize underutilized data warehouses to
    save money. With CloudWatch, you gain system-wide visibility into resource utilization,
    application performance, and operational health across all services. You can use
    CloudWatch to monitor metrics available in the console and additional metrics
    you want to monitor for Amazon Redshift provisioned clusters and serverless.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以创建警报来监控指标，并在达到限制或阈值时发送通知。您还可以设置根据阈值自动更改资源的功能；例如，您可以监控 Amazon Redshift 数据仓库中的
    CPU 使用率、查询吞吐量或等待时间，然后使用这些数据来确定是否应该增加或减少集群的大小。您还可以使用这些数据来暂停或调整未充分利用的数据仓库以节省费用。使用
    CloudWatch，您可以全面了解资源利用情况、应用程序性能以及所有服务的运行健康情况。您可以使用 CloudWatch 监控控制台中提供的指标以及您希望监控
    Amazon Redshift 预置集群和无服务器的其他指标。
- en: 'Using CloudWatch metrics for Amazon Redshift, you can get information about
    your overall cluster’s health and performance or at individual node level. When
    working with these metrics, keep in mind that each metric has one or more dimensions
    associated with it. These dimensions tell you the scope of the metric and whether
    the metric is for the data warehouse or individual nodes:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 CloudWatch 指标监控 Amazon Redshift，您可以获取关于整个集群健康和性能或单个节点级别的信息。在使用这些指标时，请记住每个指标都有一个或多个相关联的维度。这些维度告诉您指标的范围，以及指标是针对数据仓库还是单个节点：
- en: Metrics that have a NodeID dimension provide performance data for nodes of a
    cluster. This set of metrics includes leader and compute nodes. Examples of these
    metrics include CPUUtilization, ReadIOPS, and WriteIOPS.
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 具有 NodeID 维度的指标为集群节点提供性能数据。此组指标包括领导节点和计算节点。这些指标的示例包括 CPUUtilization、ReadIOPS
    和 WriteIOPS。
- en: Metrics that have only a ClusterIdentifier dimension provide performance data
    for clusters. Examples of these metrics include HealthStatus and MaintenanceMode.
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只具有 ClusterIdentifier 维度的指标为集群提供性能数据。这些指标的示例包括 HealthStatus 和 MaintenanceMode。
- en: Amazon Redshift CloudWatch Metrics
  id: totrans-286
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Amazon Redshift CloudWatch 指标
- en: On the CloudWatch console, you have various dashboards available to view service
    dashboards, cross-service dashboards, billing dashboards, or recent alarms. Amazon
    Redshift metrics are collected under the `AWS/Redshift` namespace, and these metrics
    are collected at one-minute intervals. You can can choose “Service dashboards”
    and select “Redshift” to view the metrics captured in CloudWatch, as shown in
    [Figure 10-34](#monitoring_using_cloudwatch).
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 在 CloudWatch 控制台上，您可以选择各种仪表板来查看服务仪表板、跨服务仪表板、计费仪表板或最近的警报。Amazon Redshift 指标收集在
    `AWS/Redshift` 命名空间下，每分钟收集一次这些指标。您可以选择“服务仪表板”，然后选择“Redshift”来查看在 CloudWatch 中捕获的指标，如图 10-34
    所示。
- en: '![CloudWatch monitoring](assets/ardg_1034.png)'
  id: totrans-288
  prefs: []
  type: TYPE_IMG
  zh: '![CloudWatch 监控](assets/ardg_1034.png)'
- en: Figure 10-34\. CloudWatch monitoring
  id: totrans-289
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-34\. CloudWatch 监控
- en: As you can see in [Figure 10-35](#monitoring_cloudwatch_search), you can also
    search for any other specific service in the list. AWS has precreated automatic
    dashboards available with most commonly used metrics. In addition, if you want
    to create custom dashboards, you can create your own dashboards by selecting the
    “Custom dashboards” tab.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 如你在 [图 10-35](#monitoring_cloudwatch_search) 中所见，您也可以在列表中搜索任何其他特定服务。AWS 预先创建了大多数常用指标的自动仪表板。此外，如果您想创建自定义仪表板，可以通过选择“自定义仪表板”选项卡来创建您自己的仪表板。
- en: '![CloudWatch monitoring search for Redshift](assets/ardg_1035.png)'
  id: totrans-291
  prefs: []
  type: TYPE_IMG
  zh: '![CloudWatch 监控搜索 Redshift](assets/ardg_1035.png)'
- en: Figure 10-35\. CloudWatch monitoring search for Redshift
  id: totrans-292
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 10-35\. CloudWatch 监控搜索 Redshift
- en: The automatic dashboards have metrics like CPUUtilization, PercentageDiskSpaceUsed,
    DatabaseConnections, HealthStatus, and other metrics. If you want to add new metrics,
    you can use the “Add to dashboard” button as shown in [Figure 10-36](#monitoring_cloudwatch_auto_Redshift_addtodashboard)
    to add the appropriate metrics to this dashboard, or you can create a new customer
    dashboard from the start.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 自动仪表板包含如 CPU 利用率、磁盘空间使用百分比、数据库连接数、健康状态等指标。如果要添加新指标，您可以使用“添加到仪表板”按钮，如 [图 10-36](#monitoring_cloudwatch_auto_Redshift_addtodashboard)
    所示，将适当的指标添加到此仪表板，或者您可以从头开始创建新的客户仪表板。
- en: '![CloudWatch monitoring automatic add to dashboard](assets/ardg_1036.png)'
  id: totrans-294
  prefs: []
  type: TYPE_IMG
  zh: '![CloudWatch 监控自动添加到仪表板](assets/ardg_1036.png)'
- en: Figure 10-36\. CloudWatch monitoring automatic add to dashboard
  id: totrans-295
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 10-36\. CloudWatch 监控自动添加到仪表板
- en: You can also override the period from default to any range from 1 second to
    30 days. If there are any system-level alerts, the details are captured here,
    and you can filter to view only the alerts.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以将默认的周期覆盖为从1秒到30天的任意范围。如果有系统级别的警报，详细信息将在此处捕获，您可以筛选只查看警报。
- en: '[Figure 10-37](#monitoring_cloudwatch_auto_Redshift_dashboard) shows the default
    CloudWatch monitoring dashboard, which should satisfy most use cases. But you
    can also create a custom dashboard if required.'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 10-37](#monitoring_cloudwatch_auto_Redshift_dashboard) 展示了默认的 CloudWatch
    监控仪表板，应该能满足大多数用例。但如果需要，您也可以创建自定义仪表板。'
- en: '![CloudWatch monitoring automatic dashboard](assets/ardg_1037.png)'
  id: totrans-298
  prefs: []
  type: TYPE_IMG
  zh: '![CloudWatch 监控自动仪表板](assets/ardg_1037.png)'
- en: Figure 10-37\. CloudWatch monitoring automatic dashboard
  id: totrans-299
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 10-37\. CloudWatch 监控自动仪表板
- en: To create a custom dashboard, choose the “Custom dashboards” tab and click “Custom
    dashboards,” as shown in [Figure 10-39](#monitoring_cloudwatch_custom_dashboard_create).
    You can choose the type of graph in the widget first, as shown in [Figure 10-38](#monitoring_cloudwatch_custom_dashboard_add_widget),
    to create the custom dashboard.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建自定义仪表板，请选择“自定义仪表板”选项卡，然后单击“自定义仪表板”，如 [图 10-39](#monitoring_cloudwatch_custom_dashboard_create)
    所示。您可以首先在小组件中选择图表类型，如 [图 10-38](#monitoring_cloudwatch_custom_dashboard_add_widget)，然后创建自定义仪表板。
- en: '![Add widget to custom dashboard](assets/ardg_1038.png)'
  id: totrans-301
  prefs: []
  type: TYPE_IMG
  zh: '![向自定义仪表板添加小组件](assets/ardg_1038.png)'
- en: Figure 10-38\. CloudWatch add widget to custom dashboard
  id: totrans-302
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 10-38\. CloudWatch 向自定义仪表板添加小组件
- en: '![Create custom dashboard](assets/ardg_1039.png)'
  id: totrans-303
  prefs: []
  type: TYPE_IMG
  zh: '![创建自定义仪表板](assets/ardg_1039.png)'
- en: Figure 10-39\. CloudWatch create custom dashboard
  id: totrans-304
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 10-39\. CloudWatch 创建自定义仪表板
- en: Here you can filter for Redshift-related metrics, and select any of the metrics
    available to create your own dashboard with the metrics relevant to your database
    or organization’s monitoring requirements. You can also start with the default
    dashboard and customize it by adding new metrics to the dashboard using the “Add
    to dashboard” option. In [Figure 10-40](#monitoring_cloudwatch_custom_dashboard),
    you see the metrics like “By Resource Type,” “Node Metrics,” “Aggregated by Cluster,”
    and other metrics related to WLM queues and queries.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，您可以筛选与 Redshift 相关的指标，并选择任何适用于创建自己的仪表板的指标，这些指标与您的数据库或组织的监控需求相关。您还可以从默认仪表板开始自定义，通过使用“添加到仪表板”选项向仪表板添加新指标。在
    [图 10-40](#monitoring_cloudwatch_custom_dashboard) 中，您可以看到诸如“按资源类型”、“节点指标”、“按集群聚合”等与
    WLM 队列和查询相关的指标。
- en: '![CloudWatch add metrics to custom dashboard](assets/ardg_1040.png)'
  id: totrans-306
  prefs: []
  type: TYPE_IMG
  zh: '![CloudWatch 向自定义仪表板添加指标](assets/ardg_1040.png)'
- en: Figure 10-40\. CloudWatch monitoring custom dashboard
  id: totrans-307
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 10-40\. CloudWatch 监控自定义仪表板
- en: In some cases, a cluster-specific metric represents an aggregation of node behavior.
    Some examples are HealthStatus and MaintenanceMode, where the interpretation of
    the metric value is aggregated of all compute nodes.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，特定集群指标代表节点行为的聚合。例如，健康状态和维护模式，其中指标值的解释是所有计算节点的聚合值。
- en: Monitoring Using System Tables and Views
  id: totrans-309
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用系统表和视图进行监控
- en: 'Amazon Redshift stores various information about the data warehouse in system
    tables and views, and this information is useful to understand how the system
    is functioning. These tables are available as system views prefixed with letters
    STL, SVCS, STV, and SVV in the `pg_catalog` schema, and users who have permissions
    can query these system views directly to analyze database performance. This section
    explains key details stored in these system tables, with some sample system tables
    and queries. It also explains:'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Redshift将关于数据仓库的各种信息存储在系统表和视图中，这些信息对于理解系统如何运行是有用的。这些表作为以STL、SVCS、STV和SVV字母为前缀的系统视图存在于`pg_catalog`模式中，具有权限的用户可以直接查询这些系统视图以分析数据库性能。本节解释了存储在这些系统表中的关键细节，提供了一些示例系统表和查询。它还解释了：
- en: How different types of system tables and views are generated
  id: totrans-311
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何生成不同类型的系统表和视图
- en: What types of information you can obtain from these tables
  id: totrans-312
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以从这些表中获取什么类型的信息
- en: How to join Amazon Redshift system tables to catalog tables
  id: totrans-313
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何将Amazon Redshift系统表与目录表连接
- en: How to manage the growth of system table log files
  id: totrans-314
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何管理系统表日志文件的增长
- en: Some system tables can be used only by AWS staff for diagnostic purposes. The
    following sections discuss the system tables that can be queried for useful information
    by system administrators or other database users.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 一些系统表仅供AWS员工用于诊断目的。接下来的部分将讨论系统管理员或其他数据库用户可查询的有用信息系统表。
- en: 'There are several types of system tables and views:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种类型的系统表和视图：
- en: STL system views
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: STL系统视图
- en: These are generated from logs that have been persisted to disk to provide a
    history of the system. These files reside on every node in the data warehouse
    cluster. The STL views take the information from the logs and format them into
    usable views for system administrators. STL system views retain seven days of
    log history. Log retention is guaranteed for all data warehouse sizes and node
    types, and it isn’t affected by changes in data warehouse workload. Log retention
    also isn’t affected by data warehouse status, such as when the data warehouse
    is paused. You have less than seven days of log history only in the case where
    the data warehouse is new. Retaining logs doesn’t require any customer action,
    but if you want to store log data for more than seven days, you have to periodically
    copy it to other tables or unload it to Amazon S3\. You can find the detailed
    list of views in [STL views](https://oreil.ly/O6n_N).
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 这些视图是从已持久化到磁盘的日志生成的，用于提供系统历史记录。这些文件驻留在数据仓库集群中的每个节点上。STL视图从日志中提取信息，并将其格式化为系统管理员可以使用的视图。STL系统视图保留七天的日志历史记录。日志保留对所有数据仓库大小和节点类型都是保证的，并且不受数据仓库工作负载变化的影响。日志保留也不受数据仓库状态的影响，例如数据仓库暂停时。只有在数据仓库是新的情况下，日志历史记录少于七天。保留日志不需要任何客户操作，但如果您想将日志数据存储超过七天，您必须定期将其复制到其他表或卸载到Amazon
    S3。您可以在[STL视图](https://oreil.ly/O6n_N)中找到详细的视图列表。
- en: STV tables
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: STV表
- en: These are virtual system tables that contain snapshots of the current system
    data. They are based on transient in-memory data and are not persisted to disk-based
    logs or regular tables.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是包含当前系统数据快照的虚拟系统表。它们基于瞬态的内存数据，并不持久化到磁盘日志或常规表中。
- en: SVCS system views
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: SVCS系统视图
- en: The prefix *SVCS* provides details about queries on both the main and Concurrency
    Scaling clusters. The views are similar to the tables with the prefix *STL* except
    that the STL tables provide information only for queries run on the main cluster.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 前缀*SVCS*提供了有关主集群和并发扩展集群上查询的详细信息。这些视图类似于带有前缀*STL*的表，不同之处在于STL表仅提供对主集群上运行查询的信息。
- en: SVL views
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: SVL视图
- en: These are system views in Amazon Redshift contain references to STL tables and
    logs for more detailed information. These views provide quicker and easier access
    to commonly queried data found in those tables.
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Redshift中的这些系统视图包含对STL表和日志的引用，用于提供更详细的信息。这些视图为查询这些表中常见数据提供了更快捷、更便利的访问。
- en: SVV views
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: SVV视图
- en: These system views in Amazon Redshift that contain references to STV tables
    and snapshots for more detailed information.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Redshift中的这些系统视图包含对STV表和快照的引用，以获取更详细的信息。
- en: SYS views
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: SYS视图
- en: These are system monitoring views used to monitor query and workload usage.
    These views are located in the `pg_catalog` schema. To display the information
    provided by these views, run SQL `SELECT` statements. `SYS_SERVERLESS_USAGE` gathers
    usage data for Amazon Redshift Serverless only.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是用于监控查询和工作负载使用情况的系统监控视图。这些视图位于 `pg_catalog` 模式中。要显示这些视图提供的信息，请运行 SQL `SELECT`
    语句。`SYS_SERVERLESS_USAGE` 仅收集 Amazon Redshift Serverless 的使用数据。
- en: System tables are not included in automated or manual data warehouse backups
    (snapshots). The retention period for STL system views and log history is seven
    days. If you want to store log data for more than seven days, you have to periodically
    copy it to other tables or unload it to Amazon S3\. You can write a stored procedure
    or use the [Amazon Redshift System Object Persistence Utility](https://oreil.ly/SeYIY)
    to archive data from system tables.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 系统表不包括在自动化或手动数据仓库备份（快照）中。STL 系统视图和日志历史的保留期为七天。如果要存储超过七天的日志数据，必须定期将其复制到其他表或卸载到
    Amazon S3。可以编写存储过程或使用 [Amazon Redshift 系统对象持久化实用程序](https://oreil.ly/SeYIY) 从系统表归档数据。
- en: 'There are two classes of visibility for data in system tables and views: visible
    to users and visible to superusers:'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 系统表和视图中的数据具有两类可见性：对用户可见和对超级用户可见：
- en: Superuser-visible views
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 超级用户可见视图
- en: Only users with superuser privileges can see the data in those tables that are
    in the superuser-visible category. Regular users can see data in the user-visible
    tables. To give a regular user access to superuser-visible tables, [grant `SELECT`
    privilege on that table to the regular user](https://oreil.ly/90LZA).
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 只有具有超级用户权限的用户才能查看超级用户可见类别中的表中的数据。常规用户可以查看用户可见表中的数据。要使常规用户可以访问超级用户可见表，请为该表 [授予常规用户
    `SELECT` 权限](https://oreil.ly/90LZA)。
- en: User-visible views
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 对用户可见视图
- en: By default, in most user-visible tables, rows generated by another user are
    invisible to a regular user. If a regular user is given unrestricted SYSLOG ACCESS,
    that user can see all rows in user-visible tables, including rows generated by
    another user. For more information, see information on how to [alter a user](https://oreil.ly/zbKCQ)
    or [create a user](https://oreil.ly/Uiis9).
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，在大多数用户可见表中，另一个用户生成的行对常规用户是不可见的。如果给予常规用户无限制的 SYSLOG 访问权限，则该用户可以查看所有用户可见表中的所有行，包括由其他用户生成的行。有关更多信息，请参阅如何
    [更改用户](https://oreil.ly/zbKCQ) 或 [创建用户](https://oreil.ly/Uiis9) 的信息。
- en: Giving a user unrestricted access to system tables gives the user visibility
    to data generated by other users. For example, `STL_QUERY` and `STL_QUERY_TEXT`
    contain the full text of `INSERT`, `UPDATE`, and `DELETE` statements, which might
    contain sensitive user-generated data.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 给用户无限制地访问系统表会使用户能够查看其他用户生成的数据。例如，`STL_QUERY` 和 `STL_QUERY_TEXT` 包含可能包含敏感用户生成数据的
    `INSERT`、`UPDATE` 和 `DELETE` 语句的完整文本。
- en: Monitoring Serverless Using System Views
  id: totrans-336
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用系统视图监控 Serverless
- en: Monitoring views are system views in Amazon Redshift Serverless that are used
    to monitor query and workload usage. These views are located in the `pg_catalog`
    schema. The system views available have been designed to give you the information
    needed to monitor Amazon Redshift Serverless, which is much simpler than that
    needed for provisioned clusters. The SYS system views have been designed to work
    with Amazon Redshift Serverless. To display the information provided by these
    views, you can run `SQL SELECT` statements on any of these tables or views. For
    a comprehensive list of views, you can refer to documentation on [system views](https://oreil.ly/CRJPa).
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 监控视图是 Amazon Redshift Serverless 中用于监控查询和工作负载使用情况的系统视图。这些视图位于 `pg_catalog` 模式中。这些系统视图的设计目的是为了提供监控
    Amazon Redshift Serverless 所需的信息，比起预置集群更为简单。SYS 系统视图已被设计用于与 Amazon Redshift Serverless
    协同工作。要显示这些视图提供的信息，可以在任何这些表或视图上运行 `SQL SELECT` 语句。要获取完整的视图列表，请参阅 [系统视图](https://oreil.ly/CRJPa)
    文档。
- en: System views are defined to support the following monitoring objectives. For
    a detailed list of all system views, you can refer to [“Monitoring Queries and
    Workloads with Amazon Redshift Serverless”](https://oreil.ly/gR8Y_).
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 系统视图的定义旨在支持以下监控目标。要获取所有系统视图的详细列表，请参阅 [“使用 Amazon Redshift Serverless 监控查询和工作负载”](https://oreil.ly/gR8Y_)。
- en: 'One of the views is `SYS_SERVERLESS_USAGE`, which has details on compute capacity
    and storage used with the charge seconds, and if there are any cross-region data
    transfer costs (see [Figure 10-41](#monitoring_serverless_sys_serverless_usage)).
    You can use the Query Editor V2 to query the data with a `SELECT` statement:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 其中一个视图是`SYS_SERVERLESS_USAGE`，提供有关使用的计算能力和存储以及计费秒数的详细信息，以及如果存在跨区域数据传输成本（参见[图10-41](#monitoring_serverless_sys_serverless_usage)）。您可以使用查询编辑器V2使用`SELECT`语句查询数据：
- en: '[PRE0]'
  id: totrans-340
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![Serverless monitoring using views](assets/ardg_1041.png)'
  id: totrans-341
  prefs: []
  type: TYPE_IMG
  zh: '![使用视图进行Serverless监控](assets/ardg_1041.png)'
- en: Figure 10-41\. Serverless resource monitoring
  id: totrans-342
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图10-41. Serverless资源监控
- en: 'The system views capture data to help you monitor various aspects of your data
    warehouse and the workloads you run. These views can be categorized as follows:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 系统视图捕获数据，帮助您监视数据仓库和运行的工作负载的各个方面。这些视图可以按以下方式分类：
- en: Workload monitoring
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 工作负载监控
- en: You can monitor your query activities over time to understand workload patterns
    so you know what is normal (baseline) and what is within business SLAs. This will
    help you rapidly identify deviations from normal, which might be a transient issue
    or something that warrants further action. The views `SVL_QUERY_SUMMARY`, `SYS_QUERY_HISTORY`,
    and `SYS_QUERY_DETAIL` have details on the query workloads, and you can use these
    to monitor details of each step in query for runtime, blocks read, rows returned,
    and any alerts for the query.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以随时间监视查询活动，以了解工作负载模式，从而确定什么是正常的（基线）以及符合业务SLA的内容。这将帮助您快速识别与正常情况的偏差，这可能是暂时性问题或需要进一步处理的问题。视图`SVL_QUERY_SUMMARY`、`SYS_QUERY_HISTORY`和`SYS_QUERY_DETAIL`提供有关查询工作负载的详细信息，您可以使用这些信息来监视查询运行时每个步骤的详细信息，包括运行时间、读取的块、返回的行以及查询的任何警报。
- en: Data load and unload monitoring
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 数据加载和卸载监控
- en: To move data in and out of Amazon Redshift Serverless, you use `COPY` and `UNLOAD`
    commands to load or unload data. You can monitor progress of the data load or
    unload closely in terms of bytes/rows transferred and files completed to track
    adherence to business SLAs. This is normally done by running system table queries
    frequently (that is, every minute) to track progress and raise alerts for investigation/corrective
    action if significant deviations are detected. The views `SYS_LOAD_DETAIL`, `SYS_LOAD_HISTORY`,
    `SYS_LOAD_ERROR_DETAIL`, and `SYS_UNLOAD_HISTORY` have details of rows, bytes,
    and any errors.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 要在Amazon Redshift Serverless中移动数据，您可以使用`COPY`和`UNLOAD`命令加载或卸载数据。您可以密切监视数据加载或卸载的进度，以字节/行转移和完成的文件来跟踪业务SLA的遵守情况。通常通过频繁运行系统表查询（即每分钟一次）来跟踪进度，并在检测到显著偏差时引发警报以进行调查/纠正措施。视图`SYS_LOAD_DETAIL`、`SYS_LOAD_HISTORY`、`SYS_LOAD_ERROR_DETAIL`和`SYS_UNLOAD_HISTORY`包含行、字节和任何错误的详细信息。
- en: Failure and problem diagnostics
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 失败和问题诊断
- en: There are cases where you must take action for query or runtime failures. Developers
    rely on system tables to self-diagnose issues and determine correct remedies.
    The view STL_ALERT_EVENT_LOG has details on system-wide alerts, and the views
    `STL_LOAD_ERRORS` and `SYS_LOAD_ERROR_DETAIL` have details on errors for data
    loads using `COPY` commands.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 有些情况下，您必须针对查询或运行时故障采取行动。开发人员依赖系统表自我诊断问题并确定正确的补救措施。视图`STL_ALERT_EVENT_LOG`提供系统范围警报的详细信息，视图`STL_LOAD_ERRORS`和`SYS_LOAD_ERROR_DETAIL`提供使用`COPY`命令进行数据加载时的错误详细信息。
- en: Performance tuning
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 性能调整
- en: 'You might need to tune queries that are not meeting SLA requirements either
    from the start or have degraded over time. To tune, you must have runtime details
    including run plan, statistics, duration, and resource consumption. You need baseline
    data for offending queries to determine the cause for deviation and to guide you
    how to improve performance. Some of the key tables that can be used for user object
    monitoring are:'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能需要调整未满足SLA要求的查询，无论是从一开始就未满足还是随时间降低。要进行调整，您必须有包括运行计划、统计信息、持续时间和资源消耗在内的运行时详细信息。您需要基线数据来确定引起偏差的原因，并指导您如何提高性能。一些用于用户对象监视的关键表格包括：
- en: '`SYS_QUERY_HISTORY` and `SYS_QUERY_DETAIL`'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: '`SYS_QUERY_HISTORY`和`SYS_QUERY_DETAIL`'
- en: Use these views to analyze query and tune performance by checking if there is
    long queue_time, lock_wait_time, or planning_time. You can also look at the returned_rows
    to determine if you can filter selected data.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这些视图通过检查是否存在长的`queue_time`、`lock_wait_time`或`planning_time`来分析查询并调整性能。您还可以查看返回的行以确定是否可以筛选所选数据。
- en: '`SVV_TABLE_INFO`'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: '`SVV_TABLE_INFO`'
- en: This view include details on compression encoding, distribution keys, sort style,
    data distribution skew, table size, and statistics for a particular table. Using
    this, you can diagnose and address table design issues like distribution skew
    that can influence query performance.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 此视图包括有关压缩编码、分布键、排序样式、数据分布偏差、表大小以及特定表的统计信息的详细信息。 使用这些信息，您可以诊断和解决像数据分布偏差这样可能影响查询性能的表设计问题。
- en: User objects event monitoring
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 用户对象事件监视
- en: 'You need to monitor actions and activities on user objects, such as refreshing
    materialized views, vacuum, and analyze. This includes system-managed events like
    auto-refresh for materialized views. You want to monitor when an event ends if
    it is user-initiated, or the last successful run if system-initiated. Some of
    the key tables that can be used for user object monitoring are:'
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要监视用户对象上的操作和活动，例如刷新物化视图、吸尘和分析。 这包括系统管理的事件，如物化视图的自动刷新。 如果是用户发起的事件，您希望监视事件结束的时间，或者如果是系统发起的，监视最后一次成功运行的时间。
    可用于用户对象监视的一些关键表包括：
- en: '`SVV_VACUUM_SUMMARY`, `STL_VACUUM`, `STL_SORT`, and `STL_ANALYZE`'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: '`SVV_VACUUM_SUMMARY`, `STL_VACUUM`, `STL_SORT` 和 `STL_ANALYZE`'
- en: Summarize information about vacuum, sort and analyze operations logged by the
    system.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 汇总系统记录的有关吸尘、排序和分析操作的信息。
- en: '`SVV_MV_INFO`, `SVL_MV_REFRESH_STATUS`, and `STL_MV_STATE`'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: '`SVV_MV_INFO`, `SVL_MV_REFRESH_STATUS` 和 `STL_MV_STATE`'
- en: Contains details on materialized view and refresh activity.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 包含有关物化视图和刷新活动的详细信息。
- en: Usage tracking for billing
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 用于计费的使用跟踪
- en: You can monitor your usage trends over time to inform budget planning and business
    expansion estimates. You can also identify potential cost-saving opportunities
    like adjusting your max RPU or archiving cold data. The provisioned clusters are
    billed based on type and number of nodes provisioned. For serverless, `SYS_SERVERLESS_USAGE`
    system table tracks usage and gets the charges for queries. To track spectrum
    usage, you can use the `SVL_S3QUERY_SUMMARY` view.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以随时间监视您的使用趋势，以进行预算规划和业务扩展估算。 您还可以识别潜在的节省成本的机会，如调整最大 RPU 或归档冷数据。 按所配置的节点类型和数量计费已配置的集群。
    对于无服务器，`SYS_SERVERLESS_USAGE` 系统表跟踪使用情况并获取查询的费用。 要跟踪 Spectrum 的使用情况，您可以使用 `SVL_S3QUERY_SUMMARY`
    视图。
- en: The `SVL_QUERY_SUMMARY` view contains only information about queries run by
    Amazon Redshift, not other utility and DDL commands. For a complete listing and
    information on all statements run by Amazon Redshift, including DDL and utility
    commands, you can query the `SVL_STATEMENTTEXT` view.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: '`SVL_QUERY_SUMMARY` 视图仅包含由 Amazon Redshift 运行的查询的信息，不包括其他实用程序和 DDL 命令。 要获取
    Amazon Redshift 运行的所有语句的完整列表和信息，包括DDL和实用程序命令，您可以查询 `SVL_STATEMENTTEXT` 视图。'
- en: High Availability and Disaster Recovery
  id: totrans-365
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 高可用性和灾难恢复
- en: In an organization, some applications are categorized as mission critical and
    some not deemed as critical. The mission criticality of applications has a measurement
    you can use to identify how important a workload is.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个组织中，一些应用程序被分类为关键任务，而另一些则被认为不是关键任务。 应用程序的关键任务性可以通过一个度量来衡量，您可以使用它来识别工作负载的重要性。
- en: Recovery Time Objective and Recovery Point Objective Considerations
  id: totrans-367
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 恢复时间目标和恢复点目标考虑事项
- en: 'Mission criticality of your applications or workloads is determined by two
    dimensions, and when designing a backup and recovery architecture for your production
    application, you have to consider these two factors:'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 您的应用程序或工作负载的关键任务性由两个维度决定，在设计生产应用程序的备份和恢复架构时，您必须考虑这两个因素：
- en: What is the acceptable time to recover from disaster recovery scenario? (Recovery
    Time Objective [RTO])
  id: totrans-369
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 灾难恢复场景中恢复的可接受时间是多少？（恢复时间目标 [RTO]）
- en: What is the acceptable point in time in which all data ingested into the database
    will be consistent? (Recovery Point Objective [RPO])
  id: totrans-370
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库中所有数据摄入的可接受时间点是多少？（恢复点目标 [RPO]）
- en: Recovery Time Objective
  id: totrans-371
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 恢复时间目标
- en: When using Amazon Redshift, your RTO is determined by the snapshot restore time.
    This is usually based on a volume of data in the data warehouse, node type, number
    of nodes, and the target restore data warehouse or serverless instance. You can
    test restoration from snapshots created on the production data warehouse to correctly
    determine RTO. It is also important that you retest the restore performance any
    time you resize the data warehouse or your data volume changes significantly.
    This determines what is considered an acceptable time window when service is unavailable.
    If you are using a multiple Availability Zone (Multi-AZ) configuration, RTO is
    0 because there are no snapshots to recover in a single-region strategy.
  id: totrans-372
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用 Amazon Redshift 时，您的 RTO 取决于快照恢复时间。通常基于数据仓库中的数据量、节点类型、节点数量以及目标恢复数据仓库或无服务器实例来确定。您可以测试从在生产数据仓库上创建的快照进行恢复，以正确确定
    RTO。此外，当您调整数据仓库的大小或数据量发生显著变化时，重新测试恢复性能非常重要。这将确定在服务不可用时什么被视为可接受的时间窗口。如果使用多可用区（Multi-AZ）配置，则
    RTO 为 0，因为在单区域策略中没有需要恢复的快照。
- en: Recovery Point Objective
  id: totrans-373
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 恢复点目标（RPO）
- en: With Amazon Redshift, automated backups are triggered based on a threshold of
    blocks changed (5 GB) or after a certain amount of time (eight hours). For a data
    warehouse with minimal changes to data, a backup is taken after approximately
    every eight hours. For a data warehouse that churns a massive amount of data,
    backups can be taken several times per hour. If you find that your data churn
    rate isn’t triggering automated backups at a frequency that satisfies your RPO,
    then you need to build custom solutions to guarantee the targeted RPO. This determines
    what is considered an acceptable loss of data between the last recovery point
    and the interruption of service.
  id: totrans-374
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用 Amazon Redshift，自动备份是基于更改的块（5 GB）的阈值或一定时间（八小时）触发的。对于数据变化较少的数据仓库，大约每八小时会进行一次备份。对于数据量大的数据仓库，备份可以每小时多次进行。如果发现您的数据变化速率没有触发自动备份以满足您的
    RPO 频率，那么您需要构建定制解决方案来保证目标 RPO 之间数据的可接受丢失。这将确定在最后一个恢复点和服务中断之间认为什么是可以接受的数据丢失。
- en: Amazon Redshift supports Multi-AZ deployments for provisioned RA3 clusters.
    Multi-AZ deployments support running your data warehouse in multiple Availability
    Zones simultaneously and can continue operating in unforeseen failure scenarios.
    A Multi-AZ deployment is intended for customers with business-critical analytics
    applications that require the highest levels of availability and resiliency.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Redshift 支持为预留 RA3 集群进行 Multi-AZ 部署。Multi-AZ 部署支持同时在多个可用区运行您的数据仓库，并且可以在意外故障场景下继续运行。Multi-AZ
    部署适用于需要最高可用性和弹性的业务关键分析应用的客户。
- en: A Redshift Multi-AZ deployment leverages compute resources in two AZs to scale
    data warehouse workload processing. The Multi-AZ feature does round robin all
    the time, irrespective of high concurrency or low, to utilize all resources. It
    will automatically leverage the resources in both AZs to provide resiliency for
    read and write requests using active-active processing. For Multi-AZ, the recommendation
    from AWS is to have twice the number of nodes for good performance. So this costs
    twice the price but can be a compelling way to buy RIs for customers expecting
    heavy concurrency/burst, and you don’t have to wait for burst cluster to become
    available.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: Redshift 的 Multi-AZ 部署利用两个可用区的计算资源来扩展数据仓库的工作负载处理。无论是高并发还是低并发，Multi-AZ 功能始终进行轮询以利用所有资源。它会自动利用两个可用区的资源，通过主动-主动处理提供读写请求的弹性。对于
    Multi-AZ，AWS 的建议是为了良好的性能，节点数要加倍。因此，这会造成双倍的价格，但对于预期有大量并发/突发情况的客户来说，这可能是一个引人注目的购买
    RI 的方式，而且您不必等待突发性集群可用。
- en: Multi-AZ Compared to Single-AZ Deployment
  id: totrans-377
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Multi-AZ 与 Single-AZ 部署比较
- en: In a Single-AZ deployment, Amazon Redshift requires a data warehouse subnet
    group to create a data warehouse in your VPC. The data warehouse subnet group
    includes information about the VPC ID and a list of subnets in your VPC. When
    you launch a cluster, Amazon Redshift either creates a default data warehouse
    subnet group automatically or you choose a data warehouse subnet group of your
    choice so that Amazon Redshift can provision your data warehouse in one of the
    subnets in the VPC. You can configure your data warehouse subnet group to add
    subnets from different Availability Zones that you want Amazon Redshift to use
    for data warehouse deployment.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 在单区部署中，Amazon Redshift 需要一个数据仓库子网组来在您的VPC中创建数据仓库。数据仓库子网组包括有关VPC ID的信息以及VPC中子网的列表。当您启动集群时，Amazon
    Redshift会自动创建一个默认的数据仓库子网组，或者您可以选择自己喜欢的数据仓库子网组，以便Amazon Redshift可以在VPC的某个子网中为您的数据仓库进行预配。您可以配置数据仓库子网组，以添加来自不同可用区的子网，Amazon
    Redshift会在这些子网中用于数据仓库部署。
- en: All Amazon Redshift clusters today are created and situated in a particular
    Availability Zone within an AWS Region and thus called Single-AZ deployments.
    For a Single-AZ deployment, Amazon Redshift selects the subnet from one of the
    Availability Zones within a Region and deploys the data warehouse there.
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 当前所有Amazon Redshift集群都是在AWS区域内特定可用区创建和定位，因此称为单区部署。对于单区部署，Amazon Redshift会从区域内一个可用区中选择子网并部署数据仓库。
- en: On the other hand, a Multi-AZ deployment is provisioned in multiple Availability
    Zones simultaneously. For a Multi-AZ deployment, Amazon Redshift automatically
    selects two subnets from two different Availability Zones and deploys an equal
    number of compute nodes in each one. All these compute nodes across Availability
    Zones are utilized via a single endpoint as the nodes from both Availability Zones
    are used for workload processing.
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，多区部署同时在多个可用区预配。对于多区部署，Amazon Redshift会自动从两个不同可用区中选择两个子网，并在每个可用区中部署相同数量的计算节点。所有这些跨可用区的计算节点通过单个端点使用，因为来自两个可用区的节点都用于工作负载处理。
- en: As shown in [Figure 10-42](#monitoring_multi_az), Amazon Redshift deploys a
    data warehouse in a single Availability Zone for Single-AZ deployment and multiple
    Availability Zones for Multi-AZ deployment.
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 如[图10-42](#monitoring_multi_az)所示，Amazon Redshift在单区部署中在一个可用区中部署数据仓库，在多区部署中在多个可用区中部署数据仓库。
- en: '![Multi-AZ compared to Single-AZ](assets/ardg_1042.png)'
  id: totrans-382
  prefs: []
  type: TYPE_IMG
  zh: '![Multi-AZ compared to Single-AZ](assets/ardg_1042.png)'
- en: Figure 10-42\. Multi-AZ compared to Single-AZ
  id: totrans-383
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图10-42. 多区部署与单区部署的比较
- en: Creating or Converting a Provisioned Data Warehouse with Multi-AZ Configuration
  id: totrans-384
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建或将预配数据仓库转换为多区配置
- en: You can set up Amazon Redshift Multi-AZ deployment while creating a new provisioned
    cluster or migrate an existing Single-AZ cluster to a Multi-AZ configuration.
    In this section, we cover both options.
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在创建新的预配集群时设置Amazon Redshift多区部署，或将现有的单区集群迁移到多区配置。本节中，我们涵盖了两种选项：
- en: Creating a new data warehouse with Multi-AZ option
  id: totrans-386
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建带有多区选项的新数据仓库
- en: You can easily create a new Multi-AZ deployment through Amazon Redshift console.
    Amazon Redshift will deploy the same number of nodes in each of the two Availability
    Zones for a Multi-AZ deployment. All nodes of a Multi-AZ deployment can perform
    read and write workload processing during normal operation. Multi-AZ deployment
    is supported only for provisioned RA3 clusters. As shown in [Figure 10-43](#monitoring_multi_az_create),
    you select “Yes” for the Multi-AZ deployment option when creating a new cluster.
    This will deploy the cluster across two Availability Zones with twice the number
    of nodes entered.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过Amazon Redshift控制台轻松创建新的多区部署。对于多区部署，Amazon Redshift将在两个可用区中部署相同数量的节点。多区部署的所有节点在正常操作期间都可以执行读写工作负载处理。多区部署仅支持配置的RA3集群。如[图10-43](#monitoring_multi_az_create)所示，在创建新集群时选择“是”以进行多区部署选项。这将在两个可用区中部署该集群，并且节点数量为输入值的两倍。
- en: To follow the detailed steps to create an Amazon Redshift provisioned data warehouse
    in multiple Availability Zones, refer to the blog post [“Enable Multi-AZ Deployments
    for Your Amazon Redshift Data Warehouse”](https://oreil.ly/GDTac).
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解如何在多个可用区中创建Amazon Redshift配置的预配数据仓库的详细步骤，请参考博客文章[“为您的Amazon Redshift数据仓库启用多区部署”](https://oreil.ly/GDTac)。
- en: For Multi-AZ, when you select the number of nodes, you will be paying for four
    nodes, as two nodes each will be available in two Availability Zones. You can
    purchase reserved instances for all four nodes.
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 对于多可用区，当您选择节点数量时，您将支付四个节点的费用，因为每个可用区将有两个节点可用。您可以为所有四个节点购买预留实例。
- en: At the time of writing this book, [the Multi-AZ feature](https://oreil.ly/CypTq)
    is in preview. Hence, you select “Preview track,” shown in [Figure 10-43](#monitoring_multi_az_create),
    to create a cluster with Multi-AZ configuration. When the feature becomes generally
    available, you can choose the current track to enable this feature instead of
    “Preview track.”
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 在撰写本书时，[多可用区功能](https://oreil.ly/CypTq) 处于预览阶段。因此，您可以选择“预览跟踪”，如 [图 10-43](#monitoring_multi_az_create)
    所示，以创建具有多可用区配置的集群。当该功能普遍可用时，您可以选择当前跟踪而不是“预览跟踪”来启用此功能。
- en: '![Create new data warehouse with Multi-AZ](assets/ardg_1043.png)'
  id: totrans-391
  prefs: []
  type: TYPE_IMG
  zh: '![创建新的多可用区数据仓库](assets/ardg_1043.png)'
- en: Figure 10-43\. Create new data warehouse with Multi-AZ
  id: totrans-392
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-43\. 创建新的多可用区数据仓库
- en: Migrating an existing data warehouse from Single-AZ to Multi-AZ
  id: totrans-393
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将现有数据仓库从单可用区迁移到多可用区
- en: If you have been running Amazon Redshift in your organization already, chances
    are it is not configured for Multi-AZ. To migrate this existing data warehouse
    to a Multi-AZ configuration, you can restore from a snapshot (see [Figure 10-44](#monitoring_multi_az_convert))
    from the existing data warehouse and configure Multi-AZ. When migrating to a Multi-AZ
    deployment from an existing Single-AZ deployment, maintaining performance of a
    single query may require the same number of nodes used in the current Single-AZ
    deployment to be provisioned in both Availability Zones. This will result in doubling
    the amount of data warehouse nodes needed when migrating to Multi-AZ to ensure
    that single query performance is maintained. For example, if you have two nodes
    in Single-AZ, when you migrate to Multi-AZ, you need to maintain two nodes on
    each AZ for the same performance.
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的组织已经在运行 Amazon Redshift，并且没有配置为多可用区，那么可以通过从现有数据仓库中恢复快照（参见 [图 10-44](#monitoring_multi_az_convert)）并配置多可用区来迁移该现有数据仓库。从现有单可用区部署迁移到多可用区部署时，为了保持单查询性能，可能需要在两个可用区中都配置与当前单可用区部署中使用的节点数量相同的节点。这样在迁移到多可用区时，需要确保提供的数据仓库节点数量加倍。例如，如果在单可用区中有两个节点，在迁移到多可用区时，需要在每个可用区中都维护两个节点以保持相同的性能。
- en: In the event of a failure in an Availability Zone, Amazon Redshift continues
    operating by using the resources in the remaining Availability Zone automatically.
    However, user connections might be lost and must be reestablished. In addition,
    queries that were running in the failed Availability Zone will be stopped. However,
    you can reconnect to your cluster and reschedule queries immediately. Amazon Redshift
    will process the rescheduled queries in the remaining Availability Zone. In the
    event that a query fails or a connection shuts down, Amazon Redshift retries the
    failed query or reestablishes connection immediately. Queries issued at or after
    a failure occurs might experience runtime delays while the Multi-AZ data warehouse
    is recovering.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个可用区发生故障，Amazon Redshift 将自动使用剩余可用区中的资源继续运行。但是，用户连接可能会丢失并且必须重新建立。此外，正在运行的位于失败可用区的查询将停止。不过，您可以重新连接到您的集群并立即重新安排查询。Amazon
    Redshift 将在剩余可用区处理重新安排的查询。如果查询失败或连接关闭，Amazon Redshift 将立即重试失败的查询或重新建立连接。在多可用区数据仓库恢复期间，可能会出现运行时延迟以处理故障发生后或发生时发出的查询。
- en: '![Convert existing data warehouse from Single-AZ to Multi-AZ](assets/ardg_1044.png)'
  id: totrans-396
  prefs: []
  type: TYPE_IMG
  zh: '![将现有单可用区数据仓库转换为多可用区](assets/ardg_1044.png)'
- en: Figure 10-44\. Convert existing data warehouse from Single-AZ to Multi-AZ
  id: totrans-397
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-44\. 将现有单可用区数据仓库转换为多可用区
- en: Auto Recovery of Multi-AZ Deployment
  id: totrans-398
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 多可用区部署的自动恢复
- en: In the unlikely event of an Availability Zone failure, Amazon Redshift Multi-AZ
    deployments continue to serve your workloads by automatically using resources
    in the other Availability Zone. You are not required to make any application changes
    to maintain business continuity during unforeseen outages since a Multi-AZ deployment
    is accessed as a single data warehouse with one endpoint. Amazon Redshift Multi-AZ
    deployments are designed to ensure there is no data loss, and you can query all
    data committed up until the point of failure.
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 在可用区失败的不太可能事件中，亚马逊 Redshift 多可用区部署将继续通过自动使用另一个可用区中的资源为您的工作负载提供服务。在意外中断期间，您无需进行任何应用程序更改以维持业务连续性，因为多可用区部署可以访问单个数据仓库端点。亚马逊
    Redshift 多可用区部署旨在确保没有数据丢失，并且可以查询在故障发生点之前提交的所有数据。
- en: As shown in [Figure 10-45](#monitoring_multi_az_recovery), if there is an unlikely
    event that causes compute nodes in AZ1 to fail, then a Multi-AZ deployment automatically
    recovers to use compute resources in AZ2\. Amazon Redshift will also automatically
    provision identical compute nodes in another Availability Zone (AZ3) to continue
    operating simultaneously in two Availability Zones (AZ2 and AZ3).
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 如图 [Figure 10-45](#monitoring_multi_az_recovery) 所示，如果发生不太可能的事件导致 AZ1 中的计算节点失败，多可用区部署将自动恢复以使用
    AZ2 的计算资源。亚马逊 Redshift 还将自动在另一个可用区（AZ3）中提供相同的计算节点，以便在两个可用区（AZ2 和 AZ3）中同时运行。
- en: '![Multi-AZ auto recovery](assets/ardg_1045.png)'
  id: totrans-401
  prefs: []
  type: TYPE_IMG
  zh: '![多可用区自动恢复](assets/ardg_1045.png)'
- en: Figure 10-45\. Multi-AZ auto recovery
  id: totrans-402
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-45\. 多可用区自动恢复
- en: Amazon Redshift Multi-AZ deployment is not only used for protection against
    the possibility of Availability Zone failures, but it can also maximize your data
    warehouse performance by automatically distributing workload processing across
    multiple Availability Zones. A Multi-AZ deployment will always process an individual
    query using compute resources only from one Availability Zone, but it can automatically
    distribute processing of multiple simultaneous queries to both Availability Zones
    to increase overall performance for high concurrency workloads.
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 亚马逊 Redshift 多可用区部署不仅用于保护免受可用区故障的可能性，还可以通过自动在多个可用区之间分布工作负载处理来最大化数据仓库的性能。多可用区部署将始终仅使用一个可用区的计算资源处理单个查询，但可以自动将多个同时查询的处理分配到两个可用区，以提高高并发工作负载的整体性能。
- en: It’s a good practice to set up automatic retries in your ETL processes and dashboards
    so that they can be reissued and served by the data warehouse in the secondary
    Availability Zone when an unlikely failure happens in the primary Availability
    Zone. If a connection is dropped, it can then be retried or reestablished immediately.
    Only the active queries or loads at the time of failure will be aborted, and any
    new queries will be routed to the secondary AZ while the nodes in the failed AZ
    are restored into another AZ.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 在 ETL 过程和仪表盘中设置自动重试是一个良好的实践，这样在主要可用区发生不太可能的故障时，可以重新发出并由辅助可用区的数据仓库提供服务。如果连接中断，可以立即重新尝试或重新建立连接。只有在故障发生时正在进行的活动查询或加载会中止，任何新查询将被路由到辅助可用区，而在失败的可用区中的节点则会恢复到另一个可用区。
- en: Snapshots, Backup, and Restore
  id: totrans-405
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 快照、备份和恢复
- en: Backup and restore operations are enabled through snapshots in Amazon Redshift.
    Snapshots are backups of a data warehouse or serverless that are taken point-in-time
    either automatically or manually.
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 通过亚马逊 Redshift 中的快照启用备份和恢复操作。快照是数据仓库或无服务器的备份，可以自动或手动地在某个时间点进行。
- en: Snapshots for Backup
  id: totrans-407
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 用于备份的快照
- en: Amazon Redshift stores these snapshots internally in Amazon S3 by using an encrypted
    Secure Sockets Layer (SSL) connection while writing to snapshots, and AWS KMS
    encryption for storage.
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 亚马逊 Redshift 在写入快照时使用加密的安全套接字层（SSL）连接将这些快照内部存储在亚马逊 S3 中，并使用 AWS KMS 加密进行存储。
- en: You can restore from a snapshot into a new data warehouse or serverless instance.
    When you restore from a snapshot, Amazon Redshift creates a new data warehouse
    and makes the new data warehouse available before all the data is loaded, so you
    can begin querying the new data warehouse immediately. The data warehouse streams
    data on demand from the snapshot in response to active queries, then loads the
    remaining data in the background. You can monitor the progress of snapshots by
    viewing the snapshot details in the AWS Management Console or by calling describe-cluster-snapshots
    in the CLI or the DescribeClusterSnapshots API action. For an in-progress snapshot,
    these display information such as the size of the incremental snapshot, the transfer
    rate, the elapsed time, and the estimated time remaining.
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从快照中恢复到新的数据仓库或无服务器实例。在恢复快照时，Amazon Redshift 会创建一个新的数据仓库，并在加载所有数据之前使新的数据仓库可用，因此您可以立即开始查询新的数据仓库。数据仓库根据活动查询按需从快照流式传输数据，然后在后台加载剩余数据。您可以通过在
    AWS 管理控制台中查看快照详细信息或通过 CLI 中的 describe-cluster-snapshots 或 DescribeClusterSnapshots
    API 操作来监视快照的进度。对于正在进行中的快照，这些信息包括增量快照的大小、传输速率、经过的时间以及估计剩余时间。
- en: Amazon Redshift stores snapshots in an internally managed Amazon S3 bucket that
    is managed by Amazon Redshift, so it is always available. To manage storage charges,
    evaluate how many days you need to keep automated snapshots and configure their
    retention period accordingly. Delete any manual snapshots that you no longer need.
    For more information about the cost of backup storage, see the [Amazon Redshift
    pricing page](https://oreil.ly/6v1Pv).
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Redshift 将快照存储在由 Amazon Redshift 管理的内部 Amazon S3 存储桶中，因此始终可用。为了管理存储费用，请评估需要保留自动快照的天数，并相应配置其保留期。删除任何不再需要的手动快照。有关备份存储成本的更多信息，请参阅[Amazon
    Redshift 价格页面](https://oreil.ly/6v1Pv)。
- en: To manage cost, you can set a retention period for both automated and manual
    snapshots. You can change the default retention period for automated and manual
    snapshots by modifying the data warehouse or the time of creation.
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 为了管理成本，您可以为自动和手动快照设置保留期。您可以通过修改数据仓库或创建时间来更改自动和手动快照的默认保留期。
- en: Automated Snapshots
  id: totrans-412
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自动快照
- en: By default, automated snapshots is enabled and Amazon Redshift periodically
    takes snapshots for every eight hours or every 5 GB per node of data changes,
    whichever comes first. If your data is larger than 5 GB * the number of nodes,
    the shortest amount of time in between automated snapshot creation is 15 minutes.
    Alternatively, you can create a snapshot schedule to control when automated snapshots
    are taken. For custom schedules, the minimum amount of time between automated
    snapshots is one hour. As you can see in [Figure 10-46](#snapshots_automatic),
    snapshots are taken periodically and spread across eight hours, as there is not
    a change in the total size.
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，自动快照已启用，并且 Amazon Redshift 定期每八小时或每个节点的数据变更超过 5 GB 时拍摄快照，以先到者为准。如果您的数据大于
    5 GB * 节点数，则自动快照创建之间的最短时间为 15 分钟。或者，您可以创建一个快照计划以控制何时拍摄自动快照。对于自定义计划，自动快照之间的最短时间为一小时。正如您在[图 10-46](#snapshots_automatic)中所看到的，快照定期拍摄并在八小时内分布，因为总大小没有变化。
- en: '![Automatic snapshots](assets/ardg_1046.png)'
  id: totrans-414
  prefs: []
  type: TYPE_IMG
  zh: '![自动快照](assets/ardg_1046.png)'
- en: Figure 10-46\. Automatic snapshots
  id: totrans-415
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-46\. 自动快照
- en: Automated snapshots are deleted at the end of a retention period and upon deletion
    of a cluster. If you are deleting a cluster, remember to take a manual snapshot
    for recovery. You can also schedule manual snapshots after daily loads to provide
    a recovery point in a disaster recovery situation.
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 自动快照在保留期结束时或删除集群时删除。如果要删除集群，请记得为恢复拍摄手动快照。您还可以安排在每日加载后手动拍摄快照，以在灾难恢复情况下提供恢复点。
- en: Manual Snapshots
  id: totrans-417
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 手动快照
- en: When you want to take a full backup of your database or need a longer retention
    period for the snapshot, you can create a manual snapshot at anytime. You can
    use the console or the CLI command `create-cluster-snapshot` to create a manual
    snapshot. In the console, after you select a cluster, under the Actions menu you
    choose “Create snapshot” to create the manual snapshot. For a manual snapshot,
    you can choose to retain indefinitely or a specific period of time using the retention
    period option, as shown in [Figure 10-47](#snapshots_manual). Manual snapshots
    are retained even when you delete the cluster. You can tag your manual snapshots
    with a date-timestamp to allow you to restore them to a previous state.
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 当您希望对数据库进行完整备份或需要较长的快照保留期时，可以随时创建手动快照。您可以使用控制台或CLI命令 `create-cluster-snapshot`
    创建手动快照。在控制台中，选择一个集群，在“操作”菜单下选择“创建快照”以创建手动快照。对于手动快照，您可以选择使用保留期选项无限期保留或特定时间段，如图[10-47](#snapshots_manual)所示。即使删除集群，手动快照也会被保留。您可以为手动快照加上日期时间戳标记，以便将其恢复到先前的状态。
- en: '![Manual snapshots](assets/ardg_1047.png)'
  id: totrans-419
  prefs: []
  type: TYPE_IMG
  zh: '![手动快照](assets/ardg_1047.png)'
- en: Figure 10-47\. Manual snapshots
  id: totrans-420
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图10-47。手动快照
- en: To improve the performance of the restore snapshot process, you can create tables
    that do not require backup with the `BACKUP NO` option. This will also reduce
    the storage used for snapshots.
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: 要提高还原快照过程的性能，可以创建不需要备份的表，并使用 `BACKUP NO` 选项。这还将减少快照使用的存储空间。
- en: Disaster Recovery Using Cross-Region Snapshots
  id: totrans-422
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用跨区域快照进行灾难恢复
- en: Disaster recovery (DR) has traditionally been important only for transactional
    applications. But recently, with the importance of data and analytics in decision
    making, data warehouse applications are becoming mission critical. Hence, DR has
    to be part of the architecture and strategy when you build a data warehouse application.
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 灾难恢复（DR）传统上仅对事务应用程序至关重要。但是最近，随着数据和分析在决策中的重要性增加，数据仓库应用程序变得至关重要。因此，在构建数据仓库应用程序时，灾难恢复必须成为架构和策略的一部分。
- en: DR is about preparing for a disaster and having the ability to quickly recover
    your operations from another region in the event of an unforeseen outage in your
    primary region.
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: DR 是关于为灾难做好准备，并在主要区域出现意外中断时快速从另一区域恢复您的操作的能力。
- en: With Amazon Redshift, cross-region snapshots can be set up from the console.
    Select a cluster and you can use the Actions menu and choose “Configure cross-region
    snapshot” as shown in [Figure 10-48](#monitoring_crossregion_snapshots) to set
    up cross-region snapshots to copy snapshots for a data warehouse to another AWS
    Region. You can configure where to copy snapshots and how long to keep copied
    automated or manual snapshots in the destination AWS Region. When cross-region
    copy is enabled for a cluster, all subsequently created manual and automated snapshots
    are copied to the specified AWS Region.
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Amazon Redshift，可以从控制台设置跨区域快照。选择一个集群，您可以使用“操作”菜单，并选择“配置跨区域快照”，如图[10-48](#monitoring_crossregion_snapshots)所示，设置跨区域快照以将数据仓库的快照复制到另一个AWS区域。您可以配置将快照复制到的位置以及在目标AWS区域中保留自动或手动快照的时间长度。当为集群启用跨区域复制时，所有随后创建的手动和自动快照都会复制到指定的AWS区域。
- en: In the event of a regional disaster, you can quickly recover in another Region,
    using the snapshot, and ensure business continuity of your applications while
    keeping your costs down.
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 在区域性灾难发生时，您可以使用快照快速在另一区域恢复，并确保应用程序的业务连续性，同时保持成本控制。
- en: '![Cross-region snapshots for disaster recovery](assets/ardg_1048.png)'
  id: totrans-427
  prefs: []
  type: TYPE_IMG
  zh: '![用于灾难恢复的跨区域快照](assets/ardg_1048.png)'
- en: Figure 10-48\. Cross-region snapshots for disaster recovery
  id: totrans-428
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图10-48。用于灾难恢复的跨区域快照
- en: 'For an active-active setup of Amazon Redshift across multiple Regions, you
    can use [Amazon Route 53](https://oreil.ly/aBBbH), a fully managed DNS service,
    to do latency-based or any rule-based routing to determine which cluster will
    be accessed by users. You can refer to this blog post: [“Building Multi-AZ or
    Multi-Region Amazon Redshift Clusters”](https://oreil.ly/AJ5Uc).'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 对于跨多个区域的Amazon Redshift的主动-主动设置，可以使用[Amazon Route 53](https://oreil.ly/aBBbH)，这是一个完全托管的DNS服务，进行基于延迟或任何规则的路由，以确定用户将访问哪个集群。您可以参考这篇博客文章：[“构建多AZ或多区域Amazon
    Redshift集群”](https://oreil.ly/AJ5Uc)。
- en: Using Snapshots for Simple-Replay
  id: totrans-430
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用快照进行简单重播
- en: For business-critical workloads that have to be available 24-7, testing different
    data model configurations or system configurations may not be possible on your
    production cluster. In these scenarios, you can use snapshots from a primary production
    data warehouse to create a test environment to test if the configuration changes
    meet your performance expectations. A [Simple Replay Utility](https://oreil.ly/Y0n3y)
    is a tool that you can use to perform a what-if analysis to evaluate how your
    workload performs in different scenarios with different database configurations.
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: 对于需要全天候可用的业务关键工作负载，可能无法在生产集群上测试不同的数据模型配置或系统配置。在这些场景下，您可以使用来自主生产数据仓库的快照创建一个测试环境，以测试配置更改是否符合您的性能预期。[Simple
    Replay Utility](https://oreil.ly/Y0n3y) 是一个工具，您可以使用它进行假设分析，评估您的工作负载在不同数据库配置下的性能表现。
- en: Monitoring Amazon Redshift Using CloudTrail
  id: totrans-432
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 CloudTrail 监控 Amazon Redshift
- en: '[AWS CloudTrail](https://aws.amazon.com/cloudtrail) is a service that provides
    a record of actions taken by a user, role, or AWS service in Amazon Redshift.
    CloudTrail captures all API calls, including calls from the Redshift console and
    calls through code to the Redshift operations. Amazon Redshift data sharing, Amazon
    Redshift Serverless, Amazon Redshift Data API, and Query Editor V2 are all integrated
    with AWS CloudTrail and available under CloudTrail action categories, e.g., “Redshift,”
    “Redshift-data,” “sqlworkbench,” and “Redshift-serverless.”'
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: '[AWS CloudTrail](https://aws.amazon.com/cloudtrail) 是一个记录用户、角色或 AWS 服务在 Amazon
    Redshift 中执行操作的服务。CloudTrail 捕获所有 API 调用，包括从 Redshift 控制台的调用和通过代码执行的 Redshift
    操作调用。Amazon Redshift 数据共享、Amazon Redshift 无服务器、Amazon Redshift 数据 API 和查询编辑器 V2
    都集成在 AWS CloudTrail 中，并在 CloudTrail 操作类别下提供，例如 “Redshift”、“Redshift-data”、“sqlworkbench”
    和 “Redshift-serverless”。'
- en: The events captured in CloudTrail for Amazon Redshift are continuously delivered
    to an Amazon S3 bucket. If you don’t configure a trail, you can still view the
    most recent events in the CloudTrail console in Event History. Using the information
    collected by CloudTrail, you can determine the request that was made to Redshift,
    the IP address from which the request was made, who made the request, when it
    was made, and the request parameters.
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: CloudTrail 捕获的 Amazon Redshift 事件持续传送到 Amazon S3 存储桶。如果未配置跟踪，则仍可以在 CloudTrail
    控制台的事件历史中查看最近的事件。使用 CloudTrail 收集的信息，您可以确定发送给 Redshift 的请求，请求的来源 IP 地址，请求者身份，请求时间以及请求参数。
- en: 'To monitor Amazon Redshift using CloudTrail, you can follow these steps:'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 CloudTrail 监控 Amazon Redshift，您可以按照以下步骤操作：
- en: Enable CloudTrail
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 启用 CloudTrail
- en: First, enable CloudTrail in your AWS account if you haven’t already. CloudTrail
    logs AWS API calls and captures relevant events.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在您的 AWS 帐户中启用 CloudTrail（如果尚未启用）。CloudTrail 记录 AWS API 调用并捕获相关事件。
- en: Configure Redshift Event Logging
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: 配置 Redshift 事件日志记录
- en: Enable event logging for your Amazon Redshift cluster. This will ensure that
    Redshift-related events are recorded in CloudTrail. You can enable event logging
    through the AWS Management Console or by using the AWS CLI.
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 启用 Amazon Redshift 集群的事件日志记录。这将确保将与 Redshift 相关的事件记录在 CloudTrail 中。您可以通过 AWS
    管理控制台或使用 AWS CLI 启用事件日志记录。
- en: Review CloudTrail Logs
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 CloudTrail 日志
- en: Once you have CloudTrail enabled and Redshift event logging configured, you
    can review the CloudTrail logs. These logs will contain information about Redshift
    API calls, such as cluster creation, modification, deletion, user activity, and
    more.
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦启用了 CloudTrail 并配置了 Redshift 事件日志记录，您可以查看 CloudTrail 日志。这些日志将包含有关 Redshift
    API 调用的信息，例如集群创建、修改、删除、用户活动等。
- en: Set Up Monitoring and Alerts
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 设置监控和警报
- en: Use AWS CloudWatch to set up monitoring and alerts for specific Redshift events.
    CloudWatch allows you to create custom metrics and define alarms based on specific
    thresholds or patterns in the logs. For example, you can set an alert when a cluster
    is modified or when a specific API call is made.
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 AWS CloudWatch 设置监控和警报，以监视特定的 Redshift 事件。CloudWatch 允许您创建自定义指标，并根据日志中的特定阈值或模式定义警报。例如，您可以在修改集群或进行特定
    API 调用时设置警报。
- en: Analyze and Respond
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 分析和响应
- en: Regularly review and analyze the CloudTrail logs and CloudWatch metrics to identify
    any suspicious activities or performance issues in your Amazon Redshift environment.
    Based on the findings, take appropriate actions to respond to the situation, such
    as investigating potential security breaches or optimizing query performance.
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 定期审查和分析 CloudTrail 日志和 CloudWatch 指标，以识别 Amazon Redshift 环境中的任何可疑活动或性能问题。根据发现，采取适当的措施来应对情况，例如调查潜在的安全漏洞或优化查询性能。
- en: By monitoring Amazon Redshift using CloudTrail, you can gain insights into the
    activities and usage patterns of your Redshift cluster, which helps you maintain
    security, troubleshoot issues, and optimize performance. You should use CloudTrail
    in addition to Amazon Redshift database audit logging to get a complete picture
    of operational commands run both inside and outside the data warehouse.
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用 CloudTrail 监控 Amazon Redshift，您可以深入了解 Redshift 集群的活动和使用模式，这有助于维护安全性、解决问题和优化性能。除了
    Amazon Redshift 数据库审计日志之外，您还应使用 CloudTrail，以获取内外数据仓库中运行的操作命令的完整图像。
- en: Bring Your Own Visualization Tool to Monitor Amazon Redshift
  id: totrans-447
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自定义可视化工具来监控 Amazon Redshift
- en: In addition to using queries, the console, CloudWatch, or APIs to monitor your
    data warehouse, you can also use your own visualization tool of choice to analyze
    the metrics captured by Amazon Redshift. Amazon Redshift stores metrics about
    query, ingestion, userlogs, workload management and general system configuration,
    performance, and usage metrics in system tables, as discussed in [“Monitoring
    Using System Tables and Views”](#monitoring-using-system-tables). You can query
    these system tables and views the same way you would query any other database
    tables.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 除了使用查询、控制台、CloudWatch 或 API 监控您的数据仓库外，您还可以使用您选择的自定义可视化工具来分析 Amazon Redshift
    捕获的指标。Amazon Redshift 在系统表中存储有关查询、摄取、用户日志、工作负载管理以及一般系统配置、性能和使用情况的指标，如 [“使用系统表和视图进行监控”](#monitoring-using-system-tables)
    中所讨论的那样。您可以像查询任何其他数据库表一样查询这些系统表和视图。
- en: To make it easier to monitor the data warehouse using some specific insights
    you need from system tables, you can build your own dashboards using visualization
    tools like Amazon QuickSight and Grafana. You can use JDBC/ODBC connectivity to
    connect to the database from any front-end visualization tool and create your
    custom visualization based on the metrics that are important to your organization.
    We will look at how you can use your own tool of choice to build impactful dashboards
    with examples using AWS native visualization tool Amazon QuickSight and the Grafana
    plug-in for Amazon Managed Grafana.
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更轻松地使用来自系统表的特定见解来监控数据仓库，您可以使用像 Amazon QuickSight 和 Grafana 这样的可视化工具来构建自己的仪表板。您可以使用
    JDBC/ODBC 连接从任何前端可视化工具连接到数据库，并基于对组织重要的指标创建您自定义的可视化。我们将介绍如何使用 AWS 原生可视化工具 Amazon
    QuickSight 和 Amazon 管理的 Grafana 插件来选择您喜欢的工具构建有影响力的仪表板示例。
- en: Monitor Operational Metrics Using System Tables and Amazon QuickSight
  id: totrans-450
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用系统表和 Amazon QuickSight 监控运行指标
- en: With Amazon QuickSight, you can meet varying analytical needs from the same
    source of truth through modern interactive dashboards, paginated reports, embedded
    analytics, and natural language queries. You can connect to various databases
    including Amazon Redshift to create visualizations or reports. You can build your
    own monitoring dashboards by querying the system tables similar to the one shown
    in [Figure 10-49](#monitoring_quicksight_dashboard).
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 Amazon QuickSight，您可以通过现代交互式仪表板、分页报告、嵌入式分析和自然语言查询满足不同的分析需求，这些需求都可以从同一真实数据源获得支持。您可以连接到各种数据库，包括
    Amazon Redshift，以创建可视化或报告。您可以通过查询系统表来构建自己的监控仪表板，类似于 [图 10-49](#monitoring_quicksight_dashboard)
    所示的那样。
- en: '![Create custom visualizations using QuickSight](assets/ardg_1049.png)'
  id: totrans-452
  prefs: []
  type: TYPE_IMG
  zh: '![使用 QuickSight 创建自定义可视化](assets/ardg_1049.png)'
- en: Figure 10-49\. Create custom visualizations using QuickSight
  id: totrans-453
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-49\. 使用 QuickSight 创建自定义可视化
- en: Monitor Operational Metrics Using Grafana Plug-in for Amazon Redshift
  id: totrans-454
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Amazon Redshift 的 Grafana 插件监控运行指标
- en: Grafana is an interactive open source visualization tool by Grafana Labs to
    analyze and visualize data across one or many data sources. It is used in a variety
    of modern monitoring stacks, allowing you to have a common technical base and
    apply common monitoring practices across different systems. Amazon Managed Grafana
    developed by AWS is a fully managed service for Grafana that enables you to visualize
    alerts on your metrics, logs, and traces, as shown in [Figure 10-50](#monitoring_grafana_dashboard).
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: Grafana 是由 Grafana Labs 提供的交互式开源可视化工具，用于分析和可视化来自一个或多个数据源的数据。它在各种现代监控堆栈中被使用，使您能够拥有一个共同的技术基础，并在不同系统中应用常见的监控实践。由
    AWS 开发的 Amazon 托管的 Grafana 是一个完全托管的 Grafana 服务，可帮助您在指标、日志和跟踪上可视化警报，如 [图 10-50](#monitoring_grafana_dashboard)
    所示。
- en: Grafana Reporting increases collaboration, transparency, and accountability
    while enhancing efficiency and visibility to operational metrics and trends. Using
    a tool like Grafana allows you to leverage the flexibility of using SQL to get
    insights about workloads. You can query system tables as discussed in [“Monitoring
    Using System Tables and Views”](#monitoring-using-system-tables).
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: Grafana 报告增强了协作、透明度和问责制，同时提高了操作指标和趋势的可见性和效率。使用类似 Grafana 的工具可以利用 SQL 的灵活性来获取有关工作负载的见解。您可以查询系统表，如
    [“使用系统表和视图进行监控”](#monitoring-using-system-tables) 中讨论的内容。
- en: Amazon Redshift supports a plug-in for Grafana with which you can build a consolidated
    dashboard that visualizes a set of curated operational metrics. This works on
    top of the Amazon Redshift Grafana data source, which you can add to an Amazon
    Managed Grafana workspace, as well as to any other Grafana deployments where the
    data source is installed.
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Redshift 支持一个用于 Grafana 的插件，您可以通过它构建一个可视化一组策划运行指标的集中式仪表板。这建立在 Amazon
    Redshift Grafana 数据源之上，您可以将其添加到 Amazon 托管的 Grafana 工作区以及任何其他安装了该数据源的 Grafana 部署中。
- en: For the step-by-step process to create an Amazon Managed Grafana workspace and
    configure an Amazon Redshift data warehouse with a Grafana data source, you can
    refer to the blog post [“Query and Visualize Amazon Redshift Operational Metrics
    Using the Amazon Redshift Plugin for Grafana”](https://oreil.ly/i2Yta).
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: 若要逐步创建 Amazon 托管的 Grafana 工作区，并使用 Grafana 数据源配置 Amazon Redshift 数据仓库的过程，请参阅博文
    [“使用 Amazon Redshift 插件查询和可视化 Amazon Redshift 运行指标”](https://oreil.ly/i2Yta)。
- en: '![Create custom visualizations using Grafana](assets/ardg_1050.png)'
  id: totrans-459
  prefs: []
  type: TYPE_IMG
  zh: '![使用 Grafana 创建自定义可视化](assets/ardg_1050.png)'
- en: Figure 10-50\. Create custom visualizations using Grafana
  id: totrans-460
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-50\. 使用 Grafana 创建自定义可视化
- en: 'The solution includes the following components:'
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 该解决方案包括以下组件：
- en: The Amazon Redshift data warehouse or serverless instance to get the metrics
    to analyze.
  id: totrans-462
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Amazon Redshift 数据仓库或无服务器实例用于获取要分析的指标。
- en: Amazon Managed Grafana, with the Amazon Redshift data source plug-in added to
    it. Amazon Managed Grafana communicates with the Amazon Redshift data warehouse
    via the Amazon Redshift Data Service API.
  id: totrans-463
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Amazon 托管的 Grafana，附加了 Amazon Redshift 数据源插件。Amazon 托管的 Grafana 通过 Amazon Redshift
    数据服务 API 与 Amazon Redshift 数据仓库进行通信。
- en: The Grafana web UI, with the Amazon Redshift dashboard using the Amazon Redshift
    data warehouse as the data source. The web UI communicates with Amazon Managed
    Grafana via an HTTP API.
  id: totrans-464
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Grafana Web UI，使用 Amazon Redshift 数据仓库作为数据源的 Amazon Redshift 仪表板。Web UI 通过 HTTP
    API 与 Amazon 托管的 Grafana 进行通信。
- en: The dashboard, as shown in [Figure 10-51](#monitoring_grafana_dashboard_aws),
    shows operational data from your cluster. When you add more clusters and create
    data sources for them in Grafana, you can choose them from the data source list
    on the dashboard.
  id: totrans-465
  prefs: []
  type: TYPE_NORMAL
  zh: 如 [图 10-51](#monitoring_grafana_dashboard_aws) 所示，仪表板显示了集群的运行数据。当您添加更多集群并在 Grafana
    中为它们创建数据源时，您可以从仪表板上的数据源列表中选择它们。
- en: '![Create custom dashboard visualizations using Grafana](assets/ardg_1051.png)'
  id: totrans-466
  prefs: []
  type: TYPE_IMG
  zh: '![使用 Grafana 创建自定义仪表板可视化](assets/ardg_1051.png)'
- en: Figure 10-51\. Create custom dashboard visualizations using Grafana
  id: totrans-467
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 10-51\. 使用 Grafana 创建自定义仪表板可视化
- en: Because the Amazon Redshift data source plug-in for Grafana is an open source
    project, you can install it in any Grafana deployment, whether it’s in the cloud,
    on premises, or even in a container running on your laptop. That allows you to
    seamlessly integrate Amazon Redshift monitoring into virtually all your existing
    Grafana-based monitoring stacks.
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 Amazon Redshift 数据源插件是一个开源项目，您可以将其安装在任何 Grafana 部署中，无论是在云端、本地，还是甚至在运行在您笔记本电脑上的容器中。这使您能够将
    Amazon Redshift 监控无缝集成到几乎所有现有的基于 Grafana 的监控堆栈中。
- en: Summary
  id: totrans-469
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: This chapter discussed different ways to monitor Amazon Redshift provisioned
    data warehouse and serverless. The Redshift console makes it easier for any administrator
    to view alerts on queries, ingestion workloads, or overall system resources. Since
    these statistics data are stored in physical tables, you have the flexibility
    to use your tool of choice to create alerts and monitor key metrics important
    for your workloads. We also covered how snapshots are a mechanism for backup and
    restore and the resiliency and disaster recovery options using the snapshots.
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: 本章讨论了监控亚马逊Redshift专用数据仓库和无服务器的不同方式。Redshift控制台使得任何管理员都可以更轻松地查看关于查询、摄入工作负载或整体系统资源的警报。由于这些统计数据存储在物理表中，您可以灵活使用您选择的工具创建警报，并监控对工作负载重要的关键指标。我们还涵盖了快照作为备份和恢复的机制，以及使用快照进行容错和灾难恢复的选项。
- en: This also brings us to the end of the book. We have focused on discussing architecture
    patterns and real customer scenarios based on our experience and provided insights
    into when a particular feature of Amazon Redshift could manage your data better
    and provide better access to your customers. As you have seen, we have also provided
    references to online documentation and blogs throughout the book so you can refer
    to the latest updated documentation and best practices as more capabilities are
    added. Where required, we have dived deep into certain topics and explained the
    relevance of the features to business workloads with examples. We hope you find
    this book and the resources referenced here helpful to modernize your data workloads
    on the cloud.
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: 这也将我们带到了本书的尾声。我们着重讨论了基于我们的经验的架构模式和真实客户场景，并提供了关于亚马逊Redshift特定功能何时能更好地管理您的数据并为您的客户提供更好访问的见解。正如您所见，我们还在整本书中提供了对在线文档和博客的引用，因此您可以参考最新更新的文档和最佳实践，随着增加更多的功能。在需要时，我们深入探讨了某些主题，并解释了这些特性对业务工作负载的相关性及其示例。希望您发现本书及其参考资源对现代化云端数据工作负载有所帮助。
- en: This book has explored the world of data warehousing with Amazon Redshift, providing
    a comprehensive understanding of its concepts, methodologies, and practical applications.
    We have delved into the foundational principles of data warehousing, examined
    the essential components of a robust data warehouse architecture, and discussed
    the crucial role of ETL processes, data modeling, and data governance.
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: 本书探索了使用亚马逊Redshift的数据仓库世界，全面理解其概念、方法和实际应用。我们深入研究了数据仓库的基本原理，审视了强大数据仓库架构的基本组成部分，并讨论了ETL过程、数据建模和数据治理的关键角色。
- en: We have witnessed the transformative power of data warehousing in enabling organizations
    to efficiently store, organize, and analyze vast amounts of data, ultimately driving
    informed decision making and facilitating strategic insights. By centralizing
    data from disparate sources into a unified, reliable, and accessible repository,
    data warehousing empowers businesses to unlock valuable patterns, trends, and
    correlations that can fuel their competitive advantage. We also discussed how
    while centralizing has its benefits, a decentralized data architecture called
    *data mesh* has evolved to enable ease of data access without moving data within
    or across your organization.
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: 我们见证了数据仓库在促进组织有效存储、组织和分析大量数据方面的变革力量，最终推动了基于信息的决策，并促进了战略洞见的实现。通过将来自不同来源的数据集中到一个统一、可靠且可访问的存储库中，数据仓库使企业能够揭示有价值的模式、趋势和关联，从而增强其竞争优势。我们还讨论了尽管集中化具有其优势，但一个称为*数据网格*的去中心化数据架构已经发展，以在不移动数据的情况下促进数据访问。
- en: Furthermore, this book has emphasized the importance of aligning data warehousing
    initiatives with business objectives, highlighting the significance of a well-defined
    data strategy, effective data governance frameworks, and robust data quality management
    practices. We have explored various data warehousing architectures, such as the
    traditional centralized data warehouse using star schema data model, as well as
    newer approaches including data lakes, data mesh, and data fabric and how you
    can build cloud-based solutions using Amazon Redshift. It is important for any
    data professional to recognize the evolving landscape and the need for adaptability
    to provide business insights to the key decision makers.
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，本书强调了将数据仓库倡议与业务目标对齐的重要性，突显了明确定义的数据战略、有效的数据治理框架以及健全的数据质量管理实践的重要性。我们探讨了各种数据仓库架构，例如传统的使用星型模式数据模型的集中式数据仓库，以及包括数据湖、数据网格和数据织物在内的新方法，以及如何利用Amazon
    Redshift构建基于云的解决方案。任何数据专业人士都应该意识到不断变化的景观和适应业务决策者需求的必要性。
- en: As we conclude this journey, it is essential to acknowledge that the field of
    data warehousing continues to evolve at a rapid pace, driven by advancements in
    technology, the proliferation of data sources, and evolving business needs. It
    is crucial for practitioners to stay abreast of emerging trends, such as generative
    AI, real-time data integration, big data analytics, and the integration of artificial
    intelligence and machine learning techniques into data warehousing processes.
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们结束这段旅程，必须承认数据仓库领域在技术进步、数据来源的增加和业务需求的发展驱动下仍然以快速的速度演变。对从业者来说，了解新兴趋势（如生成式人工智能、实时数据集成、大数据分析以及人工智能和机器学习技术融入数据仓库流程）至关重要。
- en: Ultimately, this book has aimed to equip its readers with a solid foundation
    in data warehousing principles, techniques, and best practices, serving as a guide
    to navigate the complex realm of data management and analytics. By understanding
    the key concepts, challenges, and opportunities associated with data warehousing,
    readers can embark on their own transformative journeys, leveraging data as a
    strategic asset and unlocking the full potential of their organizations in an
    increasingly data-driven world.
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: 最终，本书旨在为读者提供数据仓库原理、技术和最佳实践的坚实基础，作为导航数据管理和分析复杂领域的指南。通过理解与数据仓库相关的关键概念、挑战和机会，读者可以启程进行他们自己的转型之旅，在日益数据驱动的世界中利用数据作为战略资产，释放其组织的全部潜力。
